<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="../">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>Kubernetes Tutorial &mdash; Clustrix Documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="../_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=554e4187" />
            <link rel="index" title="Index" href="../genindex.html" />
            <link rel="search" title="Search" href="../search.html" />
            <link rel="top" title="Clustrix Documentation" href="#" />
            <link rel="next" title="SSH Remote Execution Tutorial" href="ssh_tutorial.html" />
            <link rel="prev" title="SGE (Sun Grid Engine) Tutorial" href="sge_tutorial.html" />
    </head>
<body>
    <script type="text/javascript" src="../_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="../index.html"
                        title="Wagtail"
                        class="logo navbar-brand"
                    >
                        <img src="../_static/img/wagtail-logo-circle.svg" width="45" height="59" alt="Wagtail"
                            class="logo-img"
                        />
                        Clustrix
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="../search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_setup.html">SSH Key Setup for Remote Clusters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/slurm_tutorial.html">SLURM Cluster Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/pbs_tutorial.html">PBS/Torque Cluster Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/kubernetes_tutorial.html">Kubernetes Cluster Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interactive Notebooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="complete_api_demo.html">Complete Clustrix API Demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurm_tutorial.html">SLURM Cluster Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="pbs_tutorial.html">PBS/Torque Cluster Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="sge_tutorial.html">SGE (Sun Grid Engine) Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Kubernetes Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssh_tutorial.html">SSH Remote Execution Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Clustrix Basic Usage Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/decorator.html">Decorator API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html">Configuration API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/local_executor.html">Local Executor API</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="../index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Kubernetes Tutorial</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="https://github.com/ContextLab/clustrixnotebooks/kubernetes_tutorial.ipynb" rel="nofollow">
        <span class="btn-icon"><span class="fab fa-github"></span></span>
        <span class="btn-text">Edit on GitHub</span>
    </a>
    <a class="btn btn-sm btn-light text-decoration-none" href="../_sources/notebooks/kubernetes_tutorial.ipynb.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="Kubernetes-Tutorial">
<h1>Kubernetes Tutorial<a class="headerlink" href="#Kubernetes-Tutorial" title="Link to this heading">¶</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/ContextLab/clustrix/blob/master/docs/notebooks/kubernetes_tutorial.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>This tutorial demonstrates how to use Clustrix with Kubernetes clusters for containerized distributed computing.</p>
<section id="Prerequisites">
<h2>Prerequisites<a class="headerlink" href="#Prerequisites" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Access to a Kubernetes cluster</p></li>
<li><p>kubectl configured for your cluster</p></li>
<li><p>Clustrix installed with Kubernetes support: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">clustrix[kubernetes]</span></code></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install Clustrix with Kubernetes support (uncomment if needed)</span>
<span class="c1"># !pip install clustrix[kubernetes]</span>

<span class="kn">import</span> <span class="nn">clustrix</span>
<span class="kn">from</span> <span class="nn">clustrix</span> <span class="kn">import</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">configure</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</section>
<section id="Kubernetes-Configuration">
<h2>Kubernetes Configuration<a class="headerlink" href="#Kubernetes-Configuration" title="Link to this heading">¶</a></h2>
<p>Configure Clustrix for your Kubernetes cluster:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure for Kubernetes cluster</span>
<span class="n">configure</span><span class="p">(</span>
    <span class="n">cluster_type</span><span class="o">=</span><span class="s2">&quot;kubernetes&quot;</span><span class="p">,</span>

    <span class="c1"># Kubernetes-specific settings</span>
    <span class="n">k8s_namespace</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>              <span class="c1"># Kubernetes namespace</span>
    <span class="n">k8s_config_file</span><span class="o">=</span><span class="s2">&quot;~/.kube/config&quot;</span><span class="p">,</span>     <span class="c1"># Path to kubeconfig</span>

    <span class="c1"># Default resource requirements</span>
    <span class="n">default_cores</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">default_memory</span><span class="o">=</span><span class="s2">&quot;4Gi&quot;</span><span class="p">,</span>                 <span class="c1"># Kubernetes format (Gi, Mi)</span>
    <span class="n">default_cpu_limit</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>                  <span class="c1"># CPU limit (can be &gt; cores)</span>
    <span class="n">default_memory_limit</span><span class="o">=</span><span class="s2">&quot;8Gi&quot;</span><span class="p">,</span>           <span class="c1"># Memory limit</span>

    <span class="c1"># Container settings</span>
    <span class="n">container_image</span><span class="o">=</span><span class="s2">&quot;python:3.11-slim&quot;</span><span class="p">,</span>  <span class="c1"># Base Python image</span>
    <span class="n">image_pull_policy</span><span class="o">=</span><span class="s2">&quot;IfNotPresent&quot;</span><span class="p">,</span>     <span class="c1"># Image pull policy</span>

    <span class="c1"># Job settings</span>
    <span class="n">job_ttl_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>                 <span class="c1"># Job cleanup after 1 hour</span>
    <span class="n">backoff_limit</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>                      <span class="c1"># Retry failed jobs up to 3 times</span>

    <span class="c1"># Cleanup</span>
    <span class="n">cleanup_on_success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">max_parallel_jobs</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kubernetes cluster configured successfully!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Example-1:-Containerized-Machine-Learning">
<h2>Example 1: Containerized Machine Learning<a class="headerlink" href="#Example-1:-Containerized-Machine-Learning" title="Link to this heading">¶</a></h2>
<p>Train machine learning models in Kubernetes pods:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@cluster</span><span class="p">(</span>
    <span class="n">cores</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;8Gi&quot;</span><span class="p">,</span>
    <span class="n">cpu_limit</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">memory_limit</span><span class="o">=</span><span class="s2">&quot;12Gi&quot;</span><span class="p">,</span>
    <span class="n">container_image</span><span class="o">=</span><span class="s2">&quot;python:3.11&quot;</span><span class="p">,</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;ml-training&quot;</span>  <span class="c1"># Custom job name</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">distributed_ml_training</span><span class="p">(</span><span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;random_forest&quot;</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">dataset_size</span><span class="o">=</span><span class="mi">50000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Distributed machine learning training in Kubernetes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

    <span class="c1"># Install required packages within the container</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;pip install scikit-learn pandas numpy&quot;</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span>
    <span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
    <span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
    <span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
    <span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">GridSearchCV</span>
    <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span>
    <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting ML training: </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">n_estimators</span><span class="si">}</span><span class="s2"> estimators, </span><span class="si">{</span><span class="n">dataset_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pod started at: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate synthetic dataset</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating synthetic dataset...&quot;</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="n">dataset_size</span><span class="p">,</span>
        <span class="n">n_features</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">n_informative</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">n_redundant</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">n_classes</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">n_clusters_per_class</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">flip_y</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># Add some noise</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">)</span>

    <span class="c1"># Split the data</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span>
    <span class="p">)</span>

    <span class="c1"># Feature scaling for SVM and MLP</span>
    <span class="k">if</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;svm&#39;</span><span class="p">,</span> <span class="s1">&#39;mlp&#39;</span><span class="p">]:</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset: </span><span class="si">{</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> training, </span><span class="si">{</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> test samples&quot;</span><span class="p">)</span>

    <span class="c1"># Model selection and configuration</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;random_forest&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">,</span>
            <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="n">n_estimators</span><span class="p">,</span>
                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span>
            <span class="p">},</span>
            <span class="s1">&#39;param_grid&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>
                <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">&#39;gradient_boosting&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">GradientBoostingClassifier</span><span class="p">,</span>
            <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="n">n_estimators</span><span class="p">,</span>
                <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span>
            <span class="p">},</span>
            <span class="s1">&#39;param_grid&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">&#39;svm&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">,</span>
            <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;rbf&#39;</span><span class="p">,</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="s1">&#39;scale&#39;</span><span class="p">,</span>
                <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span>
            <span class="p">},</span>
            <span class="s1">&#39;param_grid&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>
                <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">&#39;mlp&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">MLPClassifier</span><span class="p">,</span>
            <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
                <span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="s1">&#39;adam&#39;</span><span class="p">,</span>
                <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span>
                <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span>
            <span class="p">},</span>
            <span class="s1">&#39;param_grid&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">50</span><span class="p">,),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)],</span>
                <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">model_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;random_forest&#39;</span>  <span class="c1"># Default fallback</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">model_type</span><span class="p">]</span>

    <span class="c1"># Train base model</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2"> model...&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="n">base_model</span> <span class="o">=</span> <span class="n">model_config</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">](</span><span class="o">**</span><span class="n">model_config</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">])</span>
    <span class="n">base_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="n">training_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Base model training completed in </span><span class="si">{</span><span class="n">training_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

    <span class="c1"># Base model evaluation</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">base_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">base_accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">base_precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">base_recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">base_f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Base model performance: Accuracy=</span><span class="si">{</span><span class="n">base_accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Cross-validation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing cross-validation...&quot;</span><span class="p">)</span>
    <span class="n">cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">base_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Hyperparameter optimization</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimizing hyperparameters...&quot;</span><span class="p">)</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
        <span class="n">model_config</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">](),</span>
        <span class="n">model_config</span><span class="p">[</span><span class="s1">&#39;param_grid&#39;</span><span class="p">],</span>
        <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>

    <span class="c1"># Best model evaluation</span>
    <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_best</span><span class="p">)</span>
    <span class="n">best_precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_best</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">best_recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_best</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">best_f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_best</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimized model performance: Accuracy=</span><span class="si">{</span><span class="n">best_accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Feature importance (if available)</span>
    <span class="n">feature_importance</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s1">&#39;feature_importances_&#39;</span><span class="p">):</span>
        <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">top_features</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">feature_importance</span><span class="p">),</span>
                            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Top 5 features: </span><span class="si">{</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Feature_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">top_features</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Model complexity analysis</span>
    <span class="k">def</span> <span class="nf">analyze_model_complexity</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_type</span><span class="p">):</span>
        <span class="n">complexity_metrics</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;random_forest&#39;</span><span class="p">:</span>
            <span class="n">complexity_metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span>
                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span>
                <span class="s1">&#39;total_nodes&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">tree_</span><span class="o">.</span><span class="n">node_count</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">),</span>
                <span class="s1">&#39;avg_depth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">tree_</span><span class="o">.</span><span class="n">max_depth</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;gradient_boosting&#39;</span><span class="p">:</span>
            <span class="n">complexity_metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span>
                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span>
                <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">,</span>
                <span class="s1">&#39;total_nodes&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tree_</span><span class="o">.</span><span class="n">node_count</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;svm&#39;</span><span class="p">:</span>
            <span class="n">complexity_metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;n_support_vectors&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_support_</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">kernel</span><span class="p">,</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">C</span><span class="p">,</span>
                <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">gamma</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;mlp&#39;</span><span class="p">:</span>
            <span class="n">complexity_metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;hidden_layers&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">hidden_layer_sizes</span><span class="p">),</span>
                <span class="s1">&#39;total_parameters&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coefs_</span><span class="p">)</span> <span class="o">+</span>
                                  <span class="nb">sum</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">intercepts_</span><span class="p">),</span>
                <span class="s1">&#39;n_iterations&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_iter_</span><span class="p">,</span>
                <span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">loss_</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">complexity_metrics</span>

    <span class="n">complexity_metrics</span> <span class="o">=</span> <span class="n">analyze_model_complexity</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="n">model_type</span><span class="p">)</span>

    <span class="c1"># Compile results</span>
    <span class="n">training_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;model_info&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;model_type&#39;</span><span class="p">:</span> <span class="n">model_type</span><span class="p">,</span>
            <span class="s1">&#39;dataset_size&#39;</span><span class="p">:</span> <span class="n">dataset_size</span><span class="p">,</span>
            <span class="s1">&#39;n_features&#39;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;n_classes&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span>
            <span class="s1">&#39;training_samples&#39;</span><span class="p">:</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;test_samples&#39;</span><span class="p">:</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="s1">&#39;training_metrics&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;training_time_seconds&#39;</span><span class="p">:</span> <span class="n">training_time</span><span class="p">,</span>
            <span class="s1">&#39;hyperparameter_optimization&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;cross_validation_folds&#39;</span><span class="p">:</span> <span class="mi">5</span>
        <span class="p">},</span>
        <span class="s1">&#39;base_model_performance&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="n">base_accuracy</span><span class="p">,</span>
            <span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="n">base_precision</span><span class="p">,</span>
            <span class="s1">&#39;recall&#39;</span><span class="p">:</span> <span class="n">base_recall</span><span class="p">,</span>
            <span class="s1">&#39;f1_score&#39;</span><span class="p">:</span> <span class="n">base_f1</span>
        <span class="p">},</span>
        <span class="s1">&#39;optimized_model_performance&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="n">best_accuracy</span><span class="p">,</span>
            <span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="n">best_precision</span><span class="p">,</span>
            <span class="s1">&#39;recall&#39;</span><span class="p">:</span> <span class="n">best_recall</span><span class="p">,</span>
            <span class="s1">&#39;f1_score&#39;</span><span class="p">:</span> <span class="n">best_f1</span><span class="p">,</span>
            <span class="s1">&#39;improvement_over_base&#39;</span><span class="p">:</span> <span class="n">best_accuracy</span> <span class="o">-</span> <span class="n">base_accuracy</span>
        <span class="p">},</span>
        <span class="s1">&#39;cross_validation&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;cv_scores&#39;</span><span class="p">:</span> <span class="n">cv_scores</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s1">&#39;cv_mean&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">),</span>
            <span class="s1">&#39;cv_std&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s1">&#39;best_hyperparameters&#39;</span><span class="p">:</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span>
        <span class="s1">&#39;model_complexity&#39;</span><span class="p">:</span> <span class="n">complexity_metrics</span><span class="p">,</span>
        <span class="s1">&#39;feature_importance&#39;</span><span class="p">:</span> <span class="n">feature_importance</span><span class="p">,</span>
        <span class="s1">&#39;kubernetes_info&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pod_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOSTNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
            <span class="s1">&#39;namespace&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;KUBERNETES_NAMESPACE&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">),</span>
            <span class="s1">&#39;completion_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">training_results</span>

<span class="c1"># Run ML training in Kubernetes</span>
<span class="n">ml_results</span> <span class="o">=</span> <span class="n">distributed_ml_training</span><span class="p">(</span>
    <span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;random_forest&quot;</span><span class="p">,</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
    <span class="n">dataset_size</span><span class="o">=</span><span class="mi">30000</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">MACHINE LEARNING TRAINING COMPLETE&quot;</span><span class="p">)</span>
<span class="n">model_info</span> <span class="o">=</span> <span class="n">ml_results</span><span class="p">[</span><span class="s1">&#39;model_info&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model: </span><span class="si">{</span><span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;model_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset: </span><span class="si">{</span><span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;dataset_size&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> samples, </span><span class="si">{</span><span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;n_features&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> features&quot;</span><span class="p">)</span>

<span class="n">base_perf</span> <span class="o">=</span> <span class="n">ml_results</span><span class="p">[</span><span class="s1">&#39;base_model_performance&#39;</span><span class="p">]</span>
<span class="n">opt_perf</span> <span class="o">=</span> <span class="n">ml_results</span><span class="p">[</span><span class="s1">&#39;optimized_model_performance&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Performance Comparison:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Base model accuracy: </span><span class="si">{</span><span class="n">base_perf</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Optimized accuracy: </span><span class="si">{</span><span class="n">opt_perf</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Improvement: +</span><span class="si">{</span><span class="n">opt_perf</span><span class="p">[</span><span class="s1">&#39;improvement_over_base&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">ml_results</span><span class="p">[</span><span class="s1">&#39;cross_validation&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cross-validation: </span><span class="si">{</span><span class="n">cv</span><span class="p">[</span><span class="s1">&#39;cv_mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv</span><span class="p">[</span><span class="s1">&#39;cv_std&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">k8s_info</span> <span class="o">=</span> <span class="n">ml_results</span><span class="p">[</span><span class="s1">&#39;kubernetes_info&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Kubernetes Info:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Pod: </span><span class="si">{</span><span class="n">k8s_info</span><span class="p">[</span><span class="s1">&#39;pod_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Namespace: </span><span class="si">{</span><span class="n">k8s_info</span><span class="p">[</span><span class="s1">&#39;namespace&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Example-2:-Distributed-Data-Processing">
<h2>Example 2: Distributed Data Processing<a class="headerlink" href="#Example-2:-Distributed-Data-Processing" title="Link to this heading">¶</a></h2>
<p>Process large datasets using Kubernetes job parallelization:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@cluster</span><span class="p">(</span>
    <span class="n">cores</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;12Gi&quot;</span><span class="p">,</span>
    <span class="n">cpu_limit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">memory_limit</span><span class="o">=</span><span class="s2">&quot;16Gi&quot;</span><span class="p">,</span>
    <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Enable automatic parallelization</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;data-processing&quot;</span><span class="p">,</span>
    <span class="n">parallelism</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># Run up to 3 pods simultaneously</span>
    <span class="n">completions</span><span class="o">=</span><span class="mi">10</span>  <span class="c1"># Total number of completions needed</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">distributed_data_analysis</span><span class="p">(</span><span class="n">data_chunks</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Distributed data analysis across multiple Kubernetes pods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">import</span> <span class="nn">math</span>

    <span class="c1"># Install required packages</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;pip install pandas scipy numpy&quot;</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting distributed data analysis: </span><span class="si">{</span><span class="n">data_chunks</span><span class="si">}</span><span class="s2"> chunks of </span><span class="si">{</span><span class="n">chunk_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> records each&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total data points: </span><span class="si">{</span><span class="n">data_chunks</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">chunk_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_synthetic_timeseries_data</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate synthetic time-series data for analysis&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">chunk_id</span> <span class="o">*</span> <span class="mi">123</span><span class="p">)</span>  <span class="c1"># Reproducible but different per chunk</span>

        <span class="c1"># Generate timestamps (1 year of hourly data)</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">chunk_id</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)]</span>

        <span class="c1"># Generate multiple correlated time series</span>
        <span class="n">base_trend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>  <span class="c1"># Long-term trend</span>
        <span class="n">seasonal</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span><span class="p">))</span>  <span class="c1"># Weekly seasonality</span>
        <span class="n">daily</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>  <span class="c1"># Daily pattern</span>

        <span class="c1"># Add different noise patterns</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>

        <span class="c1"># Primary metric (e.g., web traffic, sales, etc.)</span>
        <span class="n">primary_metric</span> <span class="o">=</span> <span class="n">base_trend</span> <span class="o">+</span> <span class="n">seasonal</span> <span class="o">+</span> <span class="n">daily</span> <span class="o">+</span> <span class="n">noise</span>
        <span class="n">primary_metric</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">primary_metric</span><span class="p">)</span>  <span class="c1"># Ensure non-negative</span>

        <span class="c1"># Secondary metrics correlated with primary</span>
        <span class="n">secondary_metric</span> <span class="o">=</span> <span class="n">primary_metric</span> <span class="o">*</span> <span class="mf">0.7</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
        <span class="n">tertiary_metric</span> <span class="o">=</span> <span class="n">primary_metric</span> <span class="o">*</span> <span class="mf">1.2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>

        <span class="c1"># Categorical data</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">]</span>
        <span class="n">category_weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
        <span class="n">categories_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">category_weights</span><span class="p">)</span>

        <span class="c1"># Geographic regions</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;North&#39;</span><span class="p">,</span> <span class="s1">&#39;South&#39;</span><span class="p">,</span> <span class="s1">&#39;East&#39;</span><span class="p">,</span> <span class="s1">&#39;West&#39;</span><span class="p">,</span> <span class="s1">&#39;Central&#39;</span><span class="p">]</span>
        <span class="n">region_weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]</span>
        <span class="n">regions_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">region_weights</span><span class="p">)</span>

        <span class="c1"># Create DataFrame</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">,</span>
            <span class="s1">&#39;primary_metric&#39;</span><span class="p">:</span> <span class="n">primary_metric</span><span class="p">,</span>
            <span class="s1">&#39;secondary_metric&#39;</span><span class="p">:</span> <span class="n">secondary_metric</span><span class="p">,</span>
            <span class="s1">&#39;tertiary_metric&#39;</span><span class="p">:</span> <span class="n">tertiary_metric</span><span class="p">,</span>
            <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">categories_data</span><span class="p">,</span>
            <span class="s1">&#39;region&#39;</span><span class="p">:</span> <span class="n">regions_data</span><span class="p">,</span>
            <span class="s1">&#39;chunk_id&#39;</span><span class="p">:</span> <span class="n">chunk_id</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">analyze_chunk_statistics</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Comprehensive statistical analysis of a data chunk&quot;&quot;&quot;</span>
        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;tertiary_metric&#39;</span><span class="p">]</span>

        <span class="n">statistics</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Basic descriptive statistics</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">:</span>
            <span class="n">series</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">statistics</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">),</span>
                <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">series</span><span class="p">)),</span>
                <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">series</span><span class="p">)),</span>
                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">series</span><span class="p">)),</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">series</span><span class="p">)),</span>
                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">series</span><span class="p">)),</span>
                <span class="s1">&#39;q25&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="mi">25</span><span class="p">)),</span>
                <span class="s1">&#39;q75&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="mi">75</span><span class="p">)),</span>
                <span class="s1">&#39;skewness&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">series</span><span class="p">)),</span>
                <span class="s1">&#39;kurtosis&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(</span><span class="n">series</span><span class="p">))</span>
            <span class="p">}</span>

        <span class="c1"># Correlation analysis</span>
        <span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
        <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;correlations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;primary_secondary&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary_metric&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;primary_tertiary&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;tertiary_metric&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;secondary_tertiary&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;secondary_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;tertiary_metric&#39;</span><span class="p">])</span>
        <span class="p">}</span>

        <span class="c1"># Categorical analysis</span>
        <span class="n">category_stats</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="n">region_stats</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

        <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;categorical&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;category_distribution&#39;</span><span class="p">:</span> <span class="n">category_stats</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s1">&#39;region_distribution&#39;</span><span class="p">:</span> <span class="n">region_stats</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s1">&#39;category_entropy&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">category_stats</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="s1">&#39;region_entropy&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">region_stats</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="c1"># Time-based analysis</span>
        <span class="n">chunk_data</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
        <span class="n">chunk_data</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>

        <span class="n">hourly_pattern</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)[</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">daily_pattern</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">)[</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;temporal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;hourly_peak&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">hourly_pattern</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()),</span>
            <span class="s1">&#39;hourly_trough&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">hourly_pattern</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()),</span>
            <span class="s1">&#39;hourly_variation&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">hourly_pattern</span><span class="o">.</span><span class="n">std</span><span class="p">()),</span>
            <span class="s1">&#39;daily_peak&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">daily_pattern</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()),</span>  <span class="c1"># 0=Monday, 6=Sunday</span>
            <span class="s1">&#39;daily_variation&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">daily_pattern</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="p">}</span>

        <span class="c1"># Anomaly detection (simple threshold-based)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">:</span>
            <span class="n">series</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">q1</span><span class="p">,</span> <span class="n">q3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">75</span><span class="p">])</span>
            <span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
            <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>
            <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>

            <span class="n">outliers</span> <span class="o">=</span> <span class="n">series</span><span class="p">[(</span><span class="n">series</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">series</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">)]</span>
            <span class="n">statistics</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s1">&#39;outliers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">),</span>
                <span class="s1">&#39;percentage&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
                <span class="s1">&#39;lower_bound&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">),</span>
                <span class="s1">&#39;upper_bound&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">upper_bound</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">statistics</span>

    <span class="k">def</span> <span class="nf">detect_patterns_and_trends</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Advanced pattern detection and trend analysis&quot;&quot;&quot;</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Trend analysis using linear regression</span>
        <span class="n">time_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;tertiary_metric&#39;</span><span class="p">]:</span>
            <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">time_index</span><span class="p">,</span> <span class="n">chunk_data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

            <span class="n">patterns</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">_trend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;slope&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">slope</span><span class="p">),</span>
                <span class="s1">&#39;r_squared&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">r_value</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;p_value&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">p_value</span><span class="p">),</span>
                <span class="s1">&#39;trend_direction&#39;</span><span class="p">:</span> <span class="s1">&#39;increasing&#39;</span> <span class="k">if</span> <span class="n">slope</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;decreasing&#39;</span><span class="p">,</span>
                <span class="s1">&#39;trend_strength&#39;</span><span class="p">:</span> <span class="s1">&#39;strong&#39;</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.7</span> <span class="k">else</span> <span class="s1">&#39;moderate&#39;</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.3</span> <span class="k">else</span> <span class="s1">&#39;weak&#39;</span>
            <span class="p">}</span>

        <span class="c1"># Seasonality detection (simplified)</span>
        <span class="n">primary_hourly</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">)[</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">hourly_variation</span> <span class="o">=</span> <span class="n">primary_hourly</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">/</span> <span class="n">primary_hourly</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">patterns</span><span class="p">[</span><span class="s1">&#39;seasonality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;hourly_coefficient_of_variation&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">hourly_variation</span><span class="p">),</span>
            <span class="s1">&#39;has_daily_pattern&#39;</span><span class="p">:</span> <span class="n">hourly_variation</span> <span class="o">&gt;</span> <span class="mf">0.15</span><span class="p">,</span>  <span class="c1"># Threshold for daily seasonality</span>
            <span class="s1">&#39;peak_hours&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">primary_hourly</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
            <span class="s1">&#39;trough_hours&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">primary_hourly</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="p">}</span>

        <span class="c1"># Change point detection (simplified)</span>
        <span class="k">def</span> <span class="nf">detect_change_points</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">window</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="n">change_points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">-</span> <span class="n">window</span><span class="p">):</span>
                <span class="n">before</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">window</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                <span class="n">after</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">window</span><span class="p">]</span>

                <span class="c1"># Statistical test for difference in means</span>
                <span class="n">t_stat</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p_val</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># Significant change</span>
                    <span class="n">change_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">change_points</span>

        <span class="n">change_points</span> <span class="o">=</span> <span class="n">detect_change_points</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">[</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">patterns</span><span class="p">[</span><span class="s1">&#39;change_points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;detected_points&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">change_points</span><span class="p">),</span>
            <span class="s1">&#39;positions&#39;</span><span class="p">:</span> <span class="n">change_points</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="k">if</span> <span class="n">change_points</span> <span class="k">else</span> <span class="p">[],</span>  <span class="c1"># First 5</span>
            <span class="s1">&#39;has_significant_changes&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">change_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">patterns</span>

    <span class="c1"># Process chunks (this loop will be automatically parallelized)</span>
    <span class="n">chunk_results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">chunk_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data_chunks</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">chunk_id</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing chunk </span><span class="si">{</span><span class="n">chunk_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">data_chunks</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="c1"># Generate data for this chunk</span>
        <span class="n">chunk_data</span> <span class="o">=</span> <span class="n">generate_synthetic_timeseries_data</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>

        <span class="c1"># Analyze the chunk</span>
        <span class="n">chunk_stats</span> <span class="o">=</span> <span class="n">analyze_chunk_statistics</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">)</span>
        <span class="n">chunk_patterns</span> <span class="o">=</span> <span class="n">detect_patterns_and_trends</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">)</span>

        <span class="n">chunk_result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;chunk_id&#39;</span><span class="p">:</span> <span class="n">chunk_id</span><span class="p">,</span>
            <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">),</span>
            <span class="s1">&#39;statistics&#39;</span><span class="p">:</span> <span class="n">chunk_stats</span><span class="p">,</span>
            <span class="s1">&#39;patterns&#39;</span><span class="p">:</span> <span class="n">chunk_patterns</span><span class="p">,</span>
            <span class="s1">&#39;processing_timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">chunk_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_result</span><span class="p">)</span>

    <span class="c1"># Aggregate results across all chunks</span>
    <span class="k">def</span> <span class="nf">aggregate_chunk_results</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Aggregate statistics across all processed chunks&quot;&quot;&quot;</span>

        <span class="n">total_records</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_results</span><span class="p">)</span>

        <span class="c1"># Aggregate basic statistics</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary_metric&#39;</span><span class="p">,</span> <span class="s1">&#39;tertiary_metric&#39;</span><span class="p">]</span>
        <span class="n">aggregated_stats</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
            <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_results</span><span class="p">]</span>
            <span class="n">stds</span> <span class="o">=</span> <span class="p">[</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_results</span><span class="p">]</span>

            <span class="n">aggregated_stats</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;global_mean&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">means</span><span class="p">)),</span>
                <span class="s1">&#39;mean_std&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">means</span><span class="p">)),</span>
                <span class="s1">&#39;avg_within_chunk_std&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stds</span><span class="p">)),</span>
                <span class="s1">&#39;total_variation&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stds</span><span class="p">))</span>
            <span class="p">}</span>

        <span class="c1"># Aggregate patterns</span>
        <span class="n">trend_directions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
            <span class="n">directions</span> <span class="o">=</span> <span class="p">[</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;patterns&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">_trend&#39;</span><span class="p">][</span><span class="s1">&#39;trend_direction&#39;</span><span class="p">]</span>
                         <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_results</span><span class="p">]</span>
            <span class="n">trend_directions</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;increasing_chunks&#39;</span><span class="p">:</span> <span class="n">directions</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;increasing&#39;</span><span class="p">),</span>
                <span class="s1">&#39;decreasing_chunks&#39;</span><span class="p">:</span> <span class="n">directions</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;decreasing&#39;</span><span class="p">),</span>
                <span class="s1">&#39;dominant_trend&#39;</span><span class="p">:</span> <span class="s1">&#39;increasing&#39;</span> <span class="k">if</span> <span class="n">directions</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;increasing&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">directions</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;decreasing&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;decreasing&#39;</span>
            <span class="p">}</span>

        <span class="c1"># Aggregate seasonality</span>
        <span class="n">seasonal_chunks</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_results</span>
                            <span class="k">if</span> <span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;patterns&#39;</span><span class="p">][</span><span class="s1">&#39;seasonality&#39;</span><span class="p">][</span><span class="s1">&#39;has_daily_pattern&#39;</span><span class="p">])</span>

        <span class="c1"># Aggregate change points</span>
        <span class="n">total_change_points</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;patterns&#39;</span><span class="p">][</span><span class="s1">&#39;change_points&#39;</span><span class="p">][</span><span class="s1">&#39;detected_points&#39;</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_results</span><span class="p">)</span>

        <span class="n">aggregated_results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;processing_summary&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">),</span>
                <span class="s1">&#39;total_records&#39;</span><span class="p">:</span> <span class="n">total_records</span><span class="p">,</span>
                <span class="s1">&#39;avg_records_per_chunk&#39;</span><span class="p">:</span> <span class="n">total_records</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">),</span>
                <span class="s1">&#39;processing_completed&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="s1">&#39;aggregated_statistics&#39;</span><span class="p">:</span> <span class="n">aggregated_stats</span><span class="p">,</span>
            <span class="s1">&#39;global_patterns&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;trend_analysis&#39;</span><span class="p">:</span> <span class="n">trend_directions</span><span class="p">,</span>
                <span class="s1">&#39;seasonality&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;chunks_with_daily_patterns&#39;</span><span class="p">:</span> <span class="n">seasonal_chunks</span><span class="p">,</span>
                    <span class="s1">&#39;percentage_seasonal&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">seasonal_chunks</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                <span class="p">},</span>
                <span class="s1">&#39;change_points&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;total_detected&#39;</span><span class="p">:</span> <span class="n">total_change_points</span><span class="p">,</span>
                    <span class="s1">&#39;avg_per_chunk&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_change_points</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">&#39;data_quality&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;chunks_processed&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">),</span>
                <span class="s1">&#39;processing_success_rate&#39;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># All chunks processed successfully</span>
                <span class="s1">&#39;data_consistency_score&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">][</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
                                                       <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_results</span><span class="p">])</span> <span class="o">/</span>
                                               <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;primary_metric&#39;</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
                                                      <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_results</span><span class="p">]))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">1.0</span>
            <span class="p">},</span>
            <span class="s1">&#39;kubernetes_execution&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pod_hostname&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOSTNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
                <span class="s1">&#39;parallel_execution&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;chunk_distribution&#39;</span><span class="p">:</span> <span class="s1">&#39;automatic_parallelization&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">aggregated_results</span>

    <span class="n">final_results</span> <span class="o">=</span> <span class="n">aggregate_chunk_results</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">)</span>
    <span class="n">final_results</span><span class="p">[</span><span class="s1">&#39;individual_chunks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk_results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># Include first 5 for inspection</span>

    <span class="k">return</span> <span class="n">final_results</span>

<span class="c1"># Run distributed data analysis</span>
<span class="n">data_results</span> <span class="o">=</span> <span class="n">distributed_data_analysis</span><span class="p">(</span><span class="n">data_chunks</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">DISTRIBUTED DATA ANALYSIS COMPLETE&quot;</span><span class="p">)</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">data_results</span><span class="p">[</span><span class="s1">&#39;processing_summary&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chunks processed: </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;total_chunks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total records: </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;total_records&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Avg records per chunk: </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;avg_records_per_chunk&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">patterns</span> <span class="o">=</span> <span class="n">data_results</span><span class="p">[</span><span class="s1">&#39;global_patterns&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Global Patterns:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Chunks with daily seasonality: </span><span class="si">{</span><span class="n">patterns</span><span class="p">[</span><span class="s1">&#39;seasonality&#39;</span><span class="p">][</span><span class="s1">&#39;chunks_with_daily_patterns&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">patterns</span><span class="p">[</span><span class="s1">&#39;seasonality&#39;</span><span class="p">][</span><span class="s1">&#39;percentage_seasonal&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total change points detected: </span><span class="si">{</span><span class="n">patterns</span><span class="p">[</span><span class="s1">&#39;change_points&#39;</span><span class="p">][</span><span class="s1">&#39;total_detected&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average change points per chunk: </span><span class="si">{</span><span class="n">patterns</span><span class="p">[</span><span class="s1">&#39;change_points&#39;</span><span class="p">][</span><span class="s1">&#39;avg_per_chunk&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">quality</span> <span class="o">=</span> <span class="n">data_results</span><span class="p">[</span><span class="s1">&#39;data_quality&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Quality:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Processing success rate: </span><span class="si">{</span><span class="n">quality</span><span class="p">[</span><span class="s1">&#39;processing_success_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Data consistency score: </span><span class="si">{</span><span class="n">quality</span><span class="p">[</span><span class="s1">&#39;data_consistency_score&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">k8s_exec</span> <span class="o">=</span> <span class="n">data_results</span><span class="p">[</span><span class="s1">&#39;kubernetes_execution&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Kubernetes Execution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Pod hostname: </span><span class="si">{</span><span class="n">k8s_exec</span><span class="p">[</span><span class="s1">&#39;pod_hostname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Parallel execution: </span><span class="si">{</span><span class="n">k8s_exec</span><span class="p">[</span><span class="s1">&#39;parallel_execution&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Example-3:-Fault-Tolerant-Scientific-Computing">
<h2>Example 3: Fault-Tolerant Scientific Computing<a class="headerlink" href="#Example-3:-Fault-Tolerant-Scientific-Computing" title="Link to this heading">¶</a></h2>
<p>Demonstrate Kubernetes’ fault tolerance and job retry capabilities:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@cluster</span><span class="p">(</span>
    <span class="n">cores</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;8Gi&quot;</span><span class="p">,</span>
    <span class="n">cpu_limit</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">memory_limit</span><span class="o">=</span><span class="s2">&quot;12Gi&quot;</span><span class="p">,</span>
    <span class="n">backoff_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Retry up to 5 times on failure</span>
    <span class="n">restart_policy</span><span class="o">=</span><span class="s2">&quot;OnFailure&quot;</span><span class="p">,</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;fault-tolerant-computation&quot;</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">fault_tolerant_monte_carlo</span><span class="p">(</span><span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">failure_probability</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">checkpoint_interval</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fault-tolerant Monte Carlo simulation with checkpointing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting fault-tolerant Monte Carlo: </span><span class="si">{</span><span class="n">n_simulations</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> simulations&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failure probability: </span><span class="si">{</span><span class="n">failure_probability</span><span class="si">}</span><span class="s2">, Checkpoint interval: </span><span class="si">{</span><span class="n">checkpoint_interval</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Simulate random failures for demonstration</span>
    <span class="k">def</span> <span class="nf">simulate_random_failure</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">failure_probability</span><span class="p">:</span>
            <span class="n">failure_types</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;Simulated network timeout&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Simulated memory pressure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Simulated compute node failure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Simulated resource exhaustion&quot;</span>
            <span class="p">]</span>
            <span class="n">failure_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">failure_types</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">failure_type</span><span class="si">}</span><span class="s2"> - continuing with fault tolerance...&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Simulate recovery time</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Checkpoint management</span>
    <span class="n">checkpoint_file</span> <span class="o">=</span> <span class="s2">&quot;/tmp/monte_carlo_checkpoint.pkl&quot;</span>

    <span class="k">def</span> <span class="nf">save_checkpoint</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">random_state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save current progress to checkpoint&quot;&quot;&quot;</span>
        <span class="n">checkpoint_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;iteration&#39;</span><span class="p">:</span> <span class="n">iteration</span><span class="p">,</span>
            <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
            <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="n">random_state</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">checkpoint_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">checkpoint_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checkpoint saved at iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save checkpoint: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_checkpoint</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load progress from checkpoint if available&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">checkpoint_file</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">checkpoint_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">checkpoint_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checkpoint loaded from iteration </span><span class="si">{</span><span class="n">checkpoint_data</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">checkpoint_data</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load checkpoint: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Monte Carlo simulation functions</span>
    <span class="k">def</span> <span class="nf">estimate_pi_sample</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Single sample for pi estimation&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">option_pricing_sample</span><span class="p">(</span><span class="n">S0</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">105</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Single Monte Carlo sample for option pricing&quot;&quot;&quot;</span>
        <span class="c1"># Geometric Brownian Motion</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">T</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">()</span>
        <span class="n">ST</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">payoff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ST</span> <span class="o">-</span> <span class="n">K</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Call option payoff</span>
        <span class="k">return</span> <span class="n">payoff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>  <span class="c1"># Discounted payoff</span>

    <span class="k">def</span> <span class="nf">portfolio_var_sample</span><span class="p">(</span><span class="n">returns_mean</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">returns_std</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">portfolio_value</span><span class="o">=</span><span class="mi">1000000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Single sample for portfolio Value at Risk calculation&quot;&quot;&quot;</span>
        <span class="n">daily_return</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">returns_mean</span><span class="o">/</span><span class="mi">252</span><span class="p">,</span> <span class="n">returns_std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">))</span>
        <span class="n">portfolio_change</span> <span class="o">=</span> <span class="n">portfolio_value</span> <span class="o">*</span> <span class="n">daily_return</span>
        <span class="k">return</span> <span class="n">portfolio_change</span>

    <span class="k">def</span> <span class="nf">percolation_sample</span><span class="p">(</span><span class="n">grid_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.593</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Single sample for percolation theory&quot;&quot;&quot;</span>
        <span class="c1"># Simplified 2D percolation</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">grid_size</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">p</span>
        <span class="c1"># Check if there&#39;s a path from top to bottom (simplified)</span>
        <span class="c1"># This is a very simplified percolation check</span>
        <span class="n">top_row</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">bottom_row</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">top_row</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bottom_row</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># Load checkpoint if available</span>
    <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">checkpoint</span><span class="p">:</span>
        <span class="n">start_iteration</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">]</span>
        <span class="n">pi_samples</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;pi_samples&#39;</span><span class="p">]</span>
        <span class="n">option_prices</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;option_prices&#39;</span><span class="p">]</span>
        <span class="n">portfolio_changes</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;portfolio_changes&#39;</span><span class="p">]</span>
        <span class="n">percolation_samples</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;percolation_samples&#39;</span><span class="p">]</span>
        <span class="c1"># Restore random state</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;random_state&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resuming from iteration </span><span class="si">{</span><span class="n">start_iteration</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_iteration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pi_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">option_prices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">portfolio_changes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">percolation_samples</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Main simulation loop with fault tolerance</span>
    <span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">successful_simulations</span> <span class="o">=</span> <span class="n">start_iteration</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_iteration</span><span class="p">,</span> <span class="n">n_simulations</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_simulations</span> <span class="o">//</span> <span class="mi">20</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Progress: </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_simulations</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">n_simulations</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

        <span class="c1"># Simulate potential failures</span>
        <span class="k">if</span> <span class="n">simulate_random_failure</span><span class="p">():</span>
            <span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>  <span class="c1"># Skip this iteration but continue</span>

        <span class="c1"># Perform Monte Carlo samples</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pi_sample</span> <span class="o">=</span> <span class="n">estimate_pi_sample</span><span class="p">()</span>
            <span class="n">option_price</span> <span class="o">=</span> <span class="n">option_pricing_sample</span><span class="p">()</span>
            <span class="n">portfolio_change</span> <span class="o">=</span> <span class="n">portfolio_var_sample</span><span class="p">()</span>
            <span class="n">percolation</span> <span class="o">=</span> <span class="n">percolation_sample</span><span class="p">()</span>

            <span class="n">pi_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi_sample</span><span class="p">)</span>
            <span class="n">option_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option_price</span><span class="p">)</span>
            <span class="n">portfolio_changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">portfolio_change</span><span class="p">)</span>
            <span class="n">percolation_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">percolation</span><span class="p">)</span>

            <span class="n">successful_simulations</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation error at iteration </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>

        <span class="c1"># Checkpoint periodically</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">checkpoint_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;pi_samples&#39;</span><span class="p">:</span> <span class="n">pi_samples</span><span class="p">,</span>
                <span class="s1">&#39;option_prices&#39;</span><span class="p">:</span> <span class="n">option_prices</span><span class="p">,</span>
                <span class="s1">&#39;portfolio_changes&#39;</span><span class="p">:</span> <span class="n">portfolio_changes</span><span class="p">,</span>
                <span class="s1">&#39;percolation_samples&#39;</span><span class="p">:</span> <span class="n">percolation_samples</span>
            <span class="p">}</span>
            <span class="n">save_checkpoint</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>

    <span class="c1"># Final calculations</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation completed. Successful: </span><span class="si">{</span><span class="n">successful_simulations</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">, Failures: </span><span class="si">{</span><span class="n">failure_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Pi estimation</span>
    <span class="n">pi_estimate</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pi_samples</span><span class="p">)</span> <span class="k">if</span> <span class="n">pi_samples</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">pi_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pi_estimate</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="k">if</span> <span class="n">pi_samples</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">pi_confidence_interval</span> <span class="o">=</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">pi_samples</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">pi_samples</span><span class="p">))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pi_samples</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># Option pricing</span>
    <span class="n">option_price_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">option_prices</span><span class="p">)</span> <span class="k">if</span> <span class="n">option_prices</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">option_price_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">option_prices</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_prices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">option_confidence_interval</span> <span class="o">=</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">option_price_std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">option_prices</span><span class="p">))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_prices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># Portfolio VaR (95% confidence)</span>
    <span class="k">if</span> <span class="n">portfolio_changes</span><span class="p">:</span>
        <span class="n">portfolio_changes_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">portfolio_changes</span><span class="p">)</span>
        <span class="n">var_95</span> <span class="o">=</span> <span class="n">portfolio_changes_sorted</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.05</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio_changes</span><span class="p">))]</span>
        <span class="n">expected_shortfall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">portfolio_changes_sorted</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.05</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio_changes</span><span class="p">))])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">var_95</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">expected_shortfall</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Percolation probability</span>
    <span class="n">percolation_probability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">percolation_samples</span><span class="p">)</span> <span class="k">if</span> <span class="n">percolation_samples</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># Cleanup checkpoint file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">checkpoint_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checkpoint file cleaned up&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">fault_tolerant_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;simulation_parameters&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;total_simulations_requested&#39;</span><span class="p">:</span> <span class="n">n_simulations</span><span class="p">,</span>
            <span class="s1">&#39;successful_simulations&#39;</span><span class="p">:</span> <span class="n">successful_simulations</span><span class="p">,</span>
            <span class="s1">&#39;simulated_failures&#39;</span><span class="p">:</span> <span class="n">failure_count</span><span class="p">,</span>
            <span class="s1">&#39;success_rate&#39;</span><span class="p">:</span> <span class="n">successful_simulations</span> <span class="o">/</span> <span class="n">n_simulations</span> <span class="k">if</span> <span class="n">n_simulations</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;checkpoint_interval&#39;</span><span class="p">:</span> <span class="n">checkpoint_interval</span>
        <span class="p">},</span>
        <span class="s1">&#39;pi_estimation&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;estimate&#39;</span><span class="p">:</span> <span class="n">pi_estimate</span><span class="p">,</span>
            <span class="s1">&#39;true_value&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="s1">&#39;absolute_error&#39;</span><span class="p">:</span> <span class="n">pi_error</span><span class="p">,</span>
            <span class="s1">&#39;relative_error_percent&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">pi_error</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;confidence_interval_95&#39;</span><span class="p">:</span> <span class="n">pi_confidence_interval</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># Scale for pi</span>
            <span class="s1">&#39;samples_used&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">pi_samples</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s1">&#39;option_pricing&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;estimated_price&#39;</span><span class="p">:</span> <span class="n">option_price_mean</span><span class="p">,</span>
            <span class="s1">&#39;price_std_dev&#39;</span><span class="p">:</span> <span class="n">option_price_std</span><span class="p">,</span>
            <span class="s1">&#39;confidence_interval_95&#39;</span><span class="p">:</span> <span class="n">option_confidence_interval</span><span class="p">,</span>
            <span class="s1">&#39;samples_used&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_prices</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s1">&#39;portfolio_risk&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;value_at_risk_95&#39;</span><span class="p">:</span> <span class="n">var_95</span><span class="p">,</span>
            <span class="s1">&#39;expected_shortfall&#39;</span><span class="p">:</span> <span class="n">expected_shortfall</span><span class="p">,</span>
            <span class="s1">&#39;daily_volatility&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">portfolio_changes</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio_changes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;samples_used&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio_changes</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s1">&#39;percolation_analysis&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;percolation_probability&#39;</span><span class="p">:</span> <span class="n">percolation_probability</span><span class="p">,</span>
            <span class="s1">&#39;theoretical_threshold&#39;</span><span class="p">:</span> <span class="mf">0.593</span><span class="p">,</span>  <span class="c1"># 2D percolation threshold</span>
            <span class="s1">&#39;samples_used&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">percolation_samples</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s1">&#39;fault_tolerance&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;checkpoint_saves&#39;</span><span class="p">:</span> <span class="n">successful_simulations</span> <span class="o">//</span> <span class="n">checkpoint_interval</span><span class="p">,</span>
            <span class="s1">&#39;recovery_successful&#39;</span><span class="p">:</span> <span class="n">checkpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;resilience_score&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">successful_simulations</span> <span class="o">/</span> <span class="p">(</span><span class="n">successful_simulations</span> <span class="o">+</span> <span class="n">failure_count</span><span class="p">))</span> <span class="k">if</span> <span class="p">(</span><span class="n">successful_simulations</span> <span class="o">+</span> <span class="n">failure_count</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="s1">&#39;kubernetes_info&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pod_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOSTNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
            <span class="s1">&#39;restart_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RESTART_COUNT&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;completion_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">fault_tolerant_results</span>

<span class="c1"># Run fault-tolerant Monte Carlo simulation</span>
<span class="n">mc_results</span> <span class="o">=</span> <span class="n">fault_tolerant_monte_carlo</span><span class="p">(</span>
    <span class="n">n_simulations</span><span class="o">=</span><span class="mi">500000</span><span class="p">,</span>
    <span class="n">failure_probability</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># 5% chance of simulated failure</span>
    <span class="n">checkpoint_interval</span><span class="o">=</span><span class="mi">50000</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">FAULT-TOLERANT MONTE CARLO COMPLETE&quot;</span><span class="p">)</span>
<span class="n">sim_params</span> <span class="o">=</span> <span class="n">mc_results</span><span class="p">[</span><span class="s1">&#39;simulation_parameters&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requested simulations: </span><span class="si">{</span><span class="n">sim_params</span><span class="p">[</span><span class="s1">&#39;total_simulations_requested&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successful simulations: </span><span class="si">{</span><span class="n">sim_params</span><span class="p">[</span><span class="s1">&#39;successful_simulations&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulated failures: </span><span class="si">{</span><span class="n">sim_params</span><span class="p">[</span><span class="s1">&#39;simulated_failures&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success rate: </span><span class="si">{</span><span class="n">sim_params</span><span class="p">[</span><span class="s1">&#39;success_rate&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="n">pi_est</span> <span class="o">=</span> <span class="n">mc_results</span><span class="p">[</span><span class="s1">&#39;pi_estimation&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pi Estimation:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Estimate: </span><span class="si">{</span><span class="n">pi_est</span><span class="p">[</span><span class="s1">&#39;estimate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  True value: </span><span class="si">{</span><span class="n">pi_est</span><span class="p">[</span><span class="s1">&#39;true_value&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Error: </span><span class="si">{</span><span class="n">pi_est</span><span class="p">[</span><span class="s1">&#39;relative_error_percent&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="n">option</span> <span class="o">=</span> <span class="n">mc_results</span><span class="p">[</span><span class="s1">&#39;option_pricing&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Option Pricing:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Estimated price: $</span><span class="si">{</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;estimated_price&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Standard deviation: $</span><span class="si">{</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;price_std_dev&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">risk</span> <span class="o">=</span> <span class="n">mc_results</span><span class="p">[</span><span class="s1">&#39;portfolio_risk&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Portfolio Risk:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  VaR (95%): $</span><span class="si">{</span><span class="n">risk</span><span class="p">[</span><span class="s1">&#39;value_at_risk_95&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Expected shortfall: $</span><span class="si">{</span><span class="n">risk</span><span class="p">[</span><span class="s1">&#39;expected_shortfall&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">fault_tol</span> <span class="o">=</span> <span class="n">mc_results</span><span class="p">[</span><span class="s1">&#39;fault_tolerance&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Fault Tolerance:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Checkpoints saved: </span><span class="si">{</span><span class="n">fault_tol</span><span class="p">[</span><span class="s1">&#39;checkpoint_saves&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Resilience score: </span><span class="si">{</span><span class="n">fault_tol</span><span class="p">[</span><span class="s1">&#39;resilience_score&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">k8s_info</span> <span class="o">=</span> <span class="n">mc_results</span><span class="p">[</span><span class="s1">&#39;kubernetes_info&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Kubernetes Info:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Pod: </span><span class="si">{</span><span class="n">k8s_info</span><span class="p">[</span><span class="s1">&#39;pod_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Restart count: </span><span class="si">{</span><span class="n">k8s_info</span><span class="p">[</span><span class="s1">&#39;restart_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Kubernetes-Resource-Management-and-Best-Practices">
<h2>Kubernetes Resource Management and Best Practices<a class="headerlink" href="#Kubernetes-Resource-Management-and-Best-Practices" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kubernetes_resource_guidelines</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Guidelines for Kubernetes resource management with Clustrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">resource_patterns</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cpu_intensive&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Mathematical computations, simulations, optimization&#39;</span><span class="p">,</span>
            <span class="s1">&#39;resource_ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;cores ≈ cpu_limit, memory moderate&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;cores&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                <span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="s1">&#39;16Gi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cpu_limit&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                <span class="s1">&#39;memory_limit&#39;</span><span class="p">:</span> <span class="s1">&#39;20Gi&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;use_cases&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Monte Carlo simulations&#39;</span><span class="p">,</span> <span class="s1">&#39;Genetic algorithms&#39;</span><span class="p">,</span> <span class="s1">&#39;Scientific computing&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="s1">&#39;memory_intensive&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Large dataset processing, in-memory analytics&#39;</span><span class="p">,</span>
            <span class="s1">&#39;resource_ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;memory &gt;&gt; cores, higher memory limits&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;cores&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="s1">&#39;32Gi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cpu_limit&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;memory_limit&#39;</span><span class="p">:</span> <span class="s1">&#39;40Gi&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;use_cases&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Big data processing&#39;</span><span class="p">,</span> <span class="s1">&#39;Large ML models&#39;</span><span class="p">,</span> <span class="s1">&#39;Genomics analysis&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="s1">&#39;io_intensive&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;File processing, database operations, network I/O&#39;</span><span class="p">,</span>
            <span class="s1">&#39;resource_ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;moderate cores and memory, focus on concurrency&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;cores&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="s1">&#39;8Gi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cpu_limit&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;memory_limit&#39;</span><span class="p">:</span> <span class="s1">&#39;12Gi&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;use_cases&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Data ingestion&#39;</span><span class="p">,</span> <span class="s1">&#39;ETL pipelines&#39;</span><span class="p">,</span> <span class="s1">&#39;Web scraping&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="s1">&#39;ml_training&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Machine learning model training&#39;</span><span class="p">,</span>
            <span class="s1">&#39;resource_ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;balanced cores and memory, burst capacity&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;cores&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="s1">&#39;24Gi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cpu_limit&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                <span class="s1">&#39;memory_limit&#39;</span><span class="p">:</span> <span class="s1">&#39;32Gi&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;use_cases&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Deep learning&#39;</span><span class="p">,</span> <span class="s1">&#39;Model hyperparameter tuning&#39;</span><span class="p">,</span> <span class="s1">&#39;Feature engineering&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kubernetes Resource Management Guidelines:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">pattern_name</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">resource_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">pattern_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Description: </span><span class="si">{</span><span class="n">pattern</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Resource ratio: </span><span class="si">{</span><span class="n">pattern</span><span class="p">[</span><span class="s1">&#39;resource_ratio&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Example configuration:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Use cases: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pattern</span><span class="p">[</span><span class="s1">&#39;use_cases&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">resource_patterns</span>

<span class="k">def</span> <span class="nf">kubernetes_job_patterns</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Common Kubernetes job patterns for different workloads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">job_patterns</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;single_job&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Single pod, run-to-completion&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;completions&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;parallelism&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;backoff_limit&#39;</span><span class="p">:</span> <span class="mi">3</span>
            <span class="p">},</span>
            <span class="s1">&#39;best_for&#39;</span><span class="p">:</span> <span class="s1">&#39;One-off computations, small datasets&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;parallel_job&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Multiple pods running simultaneously&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;completions&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;parallelism&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;backoff_limit&#39;</span><span class="p">:</span> <span class="mi">2</span>
            <span class="p">},</span>
            <span class="s1">&#39;best_for&#39;</span><span class="p">:</span> <span class="s1">&#39;Independent parallel tasks, embarrassingly parallel problems&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;queue_job&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Work queue pattern with multiple workers&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;completions&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># No fixed completion count</span>
                <span class="s1">&#39;parallelism&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;backoff_limit&#39;</span><span class="p">:</span> <span class="mi">5</span>
            <span class="p">},</span>
            <span class="s1">&#39;best_for&#39;</span><span class="p">:</span> <span class="s1">&#39;Dynamic workloads, task queues, streaming data&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;indexed_job&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Jobs with completion index for task assignment&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;completion_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;Indexed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;completions&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                <span class="s1">&#39;parallelism&#39;</span><span class="p">:</span> <span class="mi">4</span>
            <span class="p">},</span>
            <span class="s1">&#39;best_for&#39;</span><span class="p">:</span> <span class="s1">&#39;Parameter sweeps, data partitioning, batch processing&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Kubernetes Job Patterns:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">pattern_name</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">job_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">pattern_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Description: </span><span class="si">{</span><span class="n">pattern</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Best for: </span><span class="si">{</span><span class="n">pattern</span><span class="p">[</span><span class="s1">&#39;best_for&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Parameters:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">job_patterns</span>

<span class="k">def</span> <span class="nf">clustrix_kubernetes_examples</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specific Clustrix configuration examples for Kubernetes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">examples</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;basic_computation&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;clustrix_decorator&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">@cluster(</span>
<span class="s1">    cores=2,</span>
<span class="s1">    memory=&quot;4Gi&quot;,</span>
<span class="s1">    cpu_limit=3,</span>
<span class="s1">    memory_limit=&quot;6Gi&quot;,</span>
<span class="s1">    container_image=&quot;python:3.11-slim&quot;</span>
<span class="s1">)&#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;use_case&#39;</span><span class="p">:</span> <span class="s1">&#39;Simple mathematical computations&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;ml_training&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;clustrix_decorator&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">@cluster(</span>
<span class="s1">    cores=8,</span>
<span class="s1">    memory=&quot;32Gi&quot;,</span>
<span class="s1">    cpu_limit=12,</span>
<span class="s1">    memory_limit=&quot;40Gi&quot;,</span>
<span class="s1">    container_image=&quot;python:3.11&quot;,</span>
<span class="s1">    job_name=&quot;ml-training&quot;,</span>
<span class="s1">    backoff_limit=3</span>
<span class="s1">)&#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;use_case&#39;</span><span class="p">:</span> <span class="s1">&#39;Machine learning model training with fault tolerance&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;parallel_processing&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;clustrix_decorator&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">@cluster(</span>
<span class="s1">    cores=4,</span>
<span class="s1">    memory=&quot;16Gi&quot;,</span>
<span class="s1">    parallel=True,</span>
<span class="s1">    parallelism=5,</span>
<span class="s1">    completions=20,</span>
<span class="s1">    job_name=&quot;parallel-processing&quot;</span>
<span class="s1">)&#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;use_case&#39;</span><span class="p">:</span> <span class="s1">&#39;Embarrassingly parallel data processing&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;fault_tolerant&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;clustrix_decorator&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">@cluster(</span>
<span class="s1">    cores=6,</span>
<span class="s1">    memory=&quot;24Gi&quot;,</span>
<span class="s1">    backoff_limit=5,</span>
<span class="s1">    restart_policy=&quot;OnFailure&quot;,</span>
<span class="s1">    job_ttl_seconds=7200,</span>
<span class="s1">    active_deadline_seconds=3600</span>
<span class="s1">)&#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;use_case&#39;</span><span class="p">:</span> <span class="s1">&#39;Long-running computations with automatic retry&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Clustrix Kubernetes Configuration Examples:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">example_name</span><span class="p">,</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">examples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">example_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Use case: </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="s1">&#39;use_case&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">example</span><span class="p">[</span><span class="s1">&#39;clustrix_decorator&#39;</span><span class="p">])</span>

<span class="c1"># Display all guidelines</span>
<span class="n">resource_patterns</span> <span class="o">=</span> <span class="n">kubernetes_resource_guidelines</span><span class="p">()</span>
<span class="n">job_patterns</span> <span class="o">=</span> <span class="n">kubernetes_job_patterns</span><span class="p">()</span>
<span class="n">clustrix_kubernetes_examples</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Kubernetes-Cluster-Monitoring">
<h2>Kubernetes Cluster Monitoring<a class="headerlink" href="#Kubernetes-Cluster-Monitoring" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_kubernetes_cluster_status</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check Kubernetes cluster status and resources.</span>
<span class="sd">    Note: This requires kubectl to be configured properly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>
    <span class="kn">import</span> <span class="nn">json</span>

    <span class="k">def</span> <span class="nf">run_kubectl_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run kubectl command and return output&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;kubectl </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Error: Command timed out&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kubernetes Cluster Status Check:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>

    <span class="c1"># Check cluster info</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">1. Cluster Info:&quot;</span><span class="p">)</span>
    <span class="n">cluster_info</span> <span class="o">=</span> <span class="n">run_kubectl_command</span><span class="p">(</span><span class="s2">&quot;cluster-info&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cluster_info</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">cluster_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># First 3 lines</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">cluster_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check nodes</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. Node Status:&quot;</span><span class="p">)</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">run_kubectl_command</span><span class="p">(</span><span class="s2">&quot;get nodes -o wide&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># Header + first 5 nodes</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">nodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check namespaces</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3. Namespaces:&quot;</span><span class="p">)</span>
    <span class="n">namespaces</span> <span class="o">=</span> <span class="n">run_kubectl_command</span><span class="p">(</span><span class="s2">&quot;get namespaces&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">namespaces</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">namespaces</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">8</span><span class="p">]</span>  <span class="c1"># Header + first 7 namespaces</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">namespaces</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check current context</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">4. Current Context:&quot;</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">run_kubectl_command</span><span class="p">(</span><span class="s2">&quot;config current-context&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check resource quotas</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">5. Resource Quotas (default namespace):&quot;</span><span class="p">)</span>
    <span class="n">quotas</span> <span class="o">=</span> <span class="n">run_kubectl_command</span><span class="p">(</span><span class="s2">&quot;get resourcequota -n default&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;No resources found&quot;</span> <span class="ow">in</span> <span class="n">quotas</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   No resource quotas configured&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">quotas</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check running jobs</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">6. Running Jobs (default namespace):&quot;</span><span class="p">)</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="n">run_kubectl_command</span><span class="p">(</span><span class="s2">&quot;get jobs -n default&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;No resources found&quot;</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   No jobs currently running&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># Header + first 5 jobs</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check running pods</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">7. Running Pods (default namespace):&quot;</span><span class="p">)</span>
    <span class="n">pods</span> <span class="o">=</span> <span class="n">run_kubectl_command</span><span class="p">(</span><span class="s2">&quot;get pods -n default&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;No resources found&quot;</span> <span class="ow">in</span> <span class="n">pods</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   No pods currently running&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">pods</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># Header + first 5 pods</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check node resource usage</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">8. Node Resource Usage:&quot;</span><span class="p">)</span>
    <span class="n">top_nodes</span> <span class="o">=</span> <span class="n">run_kubectl_command</span><span class="p">(</span><span class="s2">&quot;top nodes&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_nodes</span> <span class="ow">and</span> <span class="s2">&quot;not available&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_nodes</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">top_nodes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># Header + first 5 nodes</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Resource metrics not available (metrics-server may not be installed)&quot;</span><span class="p">)</span>

<span class="c1"># Check cluster status</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">check_kubernetes_cluster_status</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check Kubernetes cluster status: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Make sure kubectl is installed and configured for your cluster&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Link to this heading">¶</a></h2>
<p>This tutorial covered Kubernetes usage with Clustrix:</p>
<ol class="arabic simple">
<li><p><strong>Kubernetes Configuration</strong> - Setting up Clustrix for container-based computing</p></li>
<li><p><strong>Machine Learning Training</strong> - Distributed ML workflows in pods</p></li>
<li><p><strong>Data Processing</strong> - Large-scale data analysis with automatic parallelization</p></li>
<li><p><strong>Fault Tolerance</strong> - Robust computing with checkpointing and retry mechanisms</p></li>
<li><p><strong>Resource Management</strong> - Intelligent resource allocation and limits</p></li>
<li><p><strong>Job Patterns</strong> - Different Kubernetes job execution patterns</p></li>
<li><p><strong>Cluster Monitoring</strong> - Status checking and resource monitoring</p></li>
</ol>
<section id="Key-Kubernetes-Advantages:">
<h3>Key Kubernetes Advantages:<a class="headerlink" href="#Key-Kubernetes-Advantages:" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Containerization</strong>: Consistent execution environments across clusters</p></li>
<li><p><strong>Scalability</strong>: Automatic scaling based on workload demands</p></li>
<li><p><strong>Fault Tolerance</strong>: Built-in restart and retry mechanisms</p></li>
<li><p><strong>Resource Management</strong>: Fine-grained CPU and memory control</p></li>
<li><p><strong>Isolation</strong>: Secure, isolated execution environments</p></li>
<li><p><strong>Portability</strong>: Run on any Kubernetes cluster (cloud or on-premises)</p></li>
</ul>
</section>
<section id="Best-Practices:">
<h3>Best Practices:<a class="headerlink" href="#Best-Practices:" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Resource Limits</strong>: Always set both requests and limits for predictable scheduling</p></li>
<li><p><strong>Container Images</strong>: Use specific, lightweight base images for faster startup</p></li>
<li><p><strong>Job Patterns</strong>: Choose appropriate job patterns for your workload type</p></li>
<li><p><strong>Fault Tolerance</strong>: Implement checkpointing for long-running computations</p></li>
<li><p><strong>Monitoring</strong>: Regular cluster health and resource usage monitoring</p></li>
<li><p><strong>Cleanup</strong>: Set TTL for automatic job cleanup to prevent resource buildup</p></li>
</ul>
</section>
<section id="Kubernetes-Specific-Features:">
<h3>Kubernetes-Specific Features:<a class="headerlink" href="#Kubernetes-Specific-Features:" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>``cpu_limit`` and ``memory_limit``</strong>: Resource limits for burst capacity</p></li>
<li><p><strong>``backoff_limit``</strong>: Automatic retry on failures</p></li>
<li><p><strong>``parallelism`` and ``completions``</strong>: Parallel job execution control</p></li>
<li><p><strong>``job_ttl_seconds``</strong>: Automatic cleanup of completed jobs</p></li>
<li><p><strong>``restart_policy``</strong>: Pod restart behavior on failure</p></li>
<li><p><strong>``active_deadline_seconds``</strong>: Maximum job runtime limit</p></li>
</ul>
</section>
<section id="Next-Steps:">
<h3>Next Steps:<a class="headerlink" href="#Next-Steps:" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Compare with <a class="reference internal" href="slurm_tutorial.html"><span class="doc">SLURM Tutorial</span></a> for HPC-style clusters</p></li>
<li><p>Explore <a class="reference internal" href="pbs_tutorial.html"><span class="doc">PBS Tutorial</span></a> for traditional batch systems</p></li>
<li><p>Try <a class="reference internal" href="ssh_tutorial.html"><span class="doc">SSH Tutorial</span></a> for simple remote execution</p></li>
<li><p>Check the <a class="reference internal" href="../api/config.html"><span class="doc">Configuration Guide</span></a> for advanced settings</p></li>
</ul>
<p>For more information, visit the <a class="reference external" href="https://clustrix.readthedocs.io">Clustrix Documentation</a>.</p>
</section>
</section>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="sge_tutorial.html" title="Previous">
        <span aria-hidden="true">←&nbsp;</span>SGE (Sun Grid Engine) Tutorial
    </a>
    <a class="float-right" href="ssh_tutorial.html" title="Next">
        SSH Remote Execution Tutorial <span aria-hidden="true">&nbsp;→</span>
    </a>
</nav>
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Kubernetes Tutorial</a><ul>
<li><a class="reference internal" href="#Prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#Kubernetes-Configuration">Kubernetes Configuration</a></li>
<li><a class="reference internal" href="#Example-1:-Containerized-Machine-Learning">Example 1: Containerized Machine Learning</a></li>
<li><a class="reference internal" href="#Example-2:-Distributed-Data-Processing">Example 2: Distributed Data Processing</a></li>
<li><a class="reference internal" href="#Example-3:-Fault-Tolerant-Scientific-Computing">Example 3: Fault-Tolerant Scientific Computing</a></li>
<li><a class="reference internal" href="#Kubernetes-Resource-Management-and-Best-Practices">Kubernetes Resource Management and Best Practices</a></li>
<li><a class="reference internal" href="#Kubernetes-Cluster-Monitoring">Kubernetes Cluster Monitoring</a></li>
<li><a class="reference internal" href="#Summary">Summary</a><ul>
<li><a class="reference internal" href="#Key-Kubernetes-Advantages:">Key Kubernetes Advantages:</a></li>
<li><a class="reference internal" href="#Best-Practices:">Best Practices:</a></li>
<li><a class="reference internal" href="#Kubernetes-Specific-Features:">Kubernetes-Specific Features:</a></li>
<li><a class="reference internal" href="#Next-Steps:">Next Steps:</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="PyPI">GitHub</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2025, Contextual Dynamics Laboratory
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>
                    Created using
                    <a class="text-white" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.5.0
                    </a>
                    and
                    <a class="text-white" href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 8.1.3
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="../_static/documentation_options.js?v=01f34227"></script>
        <script src="../_static/doctools.js?v=9bcbadda"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script type="text/javascript" src="../_static/dist/theme.js"></script>
        <script type="text/javascript" src="../_static/dist/vendor.js"></script>
        <script type="text/javascript" src="../_static/searchtools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("../searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>