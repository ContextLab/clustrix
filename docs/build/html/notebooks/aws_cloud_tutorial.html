<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="../">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>Amazon Web Services (AWS) Cloud Tutorial &mdash; Clustrix Documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="../_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=554e4187" />
            <link rel="index" title="Index" href="../genindex.html" />
            <link rel="search" title="Search" href="../search.html" />
            <link rel="top" title="Clustrix Documentation" href="#" />
            <link rel="next" title="Microsoft Azure Cloud Tutorial" href="azure_cloud_tutorial.html" />
            <link rel="prev" title="Clustrix Basic Usage Tutorial" href="basic_usage.html" />
    </head>
<body>
    <script type="text/javascript" src="../_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="../index.html"
                        title="Wagtail"
                        class="logo navbar-brand"
                    >
                        <img src="../_static/img/wagtail-logo-circle.svg" width="45" height="59" alt="Wagtail"
                            class="logo-img"
                        />
                        Clustrix
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="../search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_setup.html">SSH Key Setup for Remote Clusters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/slurm_tutorial.html">SLURM Cluster Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/pbs_tutorial.html">PBS/Torque Cluster Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/kubernetes_tutorial.html">Kubernetes Cluster Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interactive Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cluster_config_example.html">Clustrix Configuration Manager Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="complete_api_demo.html">Complete Clustrix API Demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurm_tutorial.html">SLURM Cluster Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="pbs_tutorial.html">PBS/Torque Cluster Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="sge_tutorial.html">SGE (Sun Grid Engine) Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes_tutorial.html">Kubernetes Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssh_tutorial.html">SSH Remote Execution Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Clustrix Basic Usage Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cloud Platform Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Amazon Web Services (AWS) Cloud Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure_cloud_tutorial.html">Microsoft Azure Cloud Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="gcp_cloud_tutorial.html">Google Cloud Platform (GCP) Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="huggingface_spaces_tutorial.html">HuggingFace Spaces Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="lambda_cloud_tutorial.html">Lambda Cloud Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="cost_monitoring_tutorial.html">Cloud Cost Monitoring and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/decorator.html">Decorator API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html">Configuration API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/notebook_magic.html">Notebook Magic Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/cost_monitoring.html">Cost Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/local_executor.html">Local Executor API</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="../index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Amazon Web Services (AWS) Cloud Tutorial</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="https://github.com/ContextLab/clustrix/blob/master/docs/source/notebooks/aws_cloud_tutorial.ipynb" rel="nofollow">
        <span class="btn-icon"><span class="fab fa-github"></span></span>
        <span class="btn-text">Edit on GitHub</span>
    </a>
    <a class="btn btn-sm btn-light text-decoration-none" href="../_sources/notebooks/aws_cloud_tutorial.ipynb.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="Amazon-Web-Services-(AWS)-Cloud-Tutorial">
<h1>Amazon Web Services (AWS) Cloud Tutorial<a class="headerlink" href="#Amazon-Web-Services-(AWS)-Cloud-Tutorial" title="Link to this heading">¶</a></h1>
<p>This tutorial demonstrates how to use Clustrix with Amazon Web Services (AWS) cloud infrastructure for scalable distributed computing.</p>
<p><a class="reference external" href="https://colab.research.google.com/github/ContextLab/clustrix/blob/master/docs/source/notebooks/aws_cloud_tutorial.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<section id="Overview">
<h2>Overview<a class="headerlink" href="#Overview" title="Link to this heading">¶</a></h2>
<p>AWS provides several services that work well with Clustrix:</p>
<ul class="simple">
<li><p><strong>EC2</strong>: Virtual machines for compute clusters</p></li>
<li><p><strong>AWS Batch</strong>: Managed job scheduling service</p></li>
<li><p><strong>ECS</strong>: Container orchestration</p></li>
<li><p><strong>ParallelCluster</strong>: HPC cluster management</p></li>
<li><p><strong>S3</strong>: Object storage for data and results</p></li>
<li><p><strong>VPC</strong>: Network isolation and security</p></li>
</ul>
</section>
<section id="Prerequisites">
<h2>Prerequisites<a class="headerlink" href="#Prerequisites" title="Link to this heading">¶</a></h2>
<p>Before starting this tutorial, ensure you have:</p>
<ol class="arabic simple">
<li><p><strong>AWS Account</strong>: Active AWS account with billing enabled</p></li>
<li><p><strong>AWS CLI</strong>: Installed and configured on your local machine</p></li>
<li><p><strong>SSH Key Pair</strong>: Generated and uploaded to AWS EC2 for secure access</p></li>
<li><p><strong>IAM Permissions</strong>: Appropriate permissions for EC2, S3, and other services</p></li>
<li><p><strong>Basic AWS Knowledge</strong>: Understanding of AWS services, regions, and availability zones</p></li>
<li><p><strong>Python Environment</strong>: Python 3.7+ with pip installed</p></li>
</ol>
</section>
<section id="Complete-AWS-Setup-Guide">
<h2>Complete AWS Setup Guide<a class="headerlink" href="#Complete-AWS-Setup-Guide" title="Link to this heading">¶</a></h2>
<section id="Step-1:-Create-AWS-Account">
<h3>Step 1: Create AWS Account<a class="headerlink" href="#Step-1:-Create-AWS-Account" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Go to <a class="reference external" href="https://aws.amazon.com">aws.amazon.com</a> and create an account</p></li>
<li><p>Verify your email and provide payment information</p></li>
<li><p>Choose the Basic Support plan (free)</p></li>
</ol>
</section>
<section id="Step-2:-Install-AWS-CLI">
<h3>Step 2: Install AWS CLI<a class="headerlink" href="#Step-2:-Install-AWS-CLI" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># On macOS</span>
brew<span class="w"> </span>install<span class="w"> </span>awscli

<span class="c1"># On Linux/WSL</span>
curl<span class="w"> </span><span class="s2">&quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;awscliv2.zip&quot;</span>
unzip<span class="w"> </span>awscliv2.zip
sudo<span class="w"> </span>./aws/install

<span class="c1"># On Windows</span>
<span class="c1"># Download and run the AWS CLI MSI installer from AWS documentation</span>
</pre></div>
</div>
</section>
<section id="Step-3:-Create-IAM-User-and-Access-Keys">
<h3>Step 3: Create IAM User and Access Keys<a class="headerlink" href="#Step-3:-Create-IAM-User-and-Access-Keys" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Go to AWS Console → IAM → Users → Create User</p></li>
<li><p>Create a user with programmatic access</p></li>
<li><p>Attach policies: <code class="docutils literal notranslate"><span class="pre">AmazonEC2FullAccess</span></code>, <code class="docutils literal notranslate"><span class="pre">AmazonS3FullAccess</span></code>, <code class="docutils literal notranslate"><span class="pre">IAMReadOnlyAccess</span></code></p></li>
<li><p>Save the Access Key ID and Secret Access Key securely</p></li>
</ol>
</section>
<section id="Step-4:-Generate-SSH-Key-Pair">
<h3>Step 4: Generate SSH Key Pair<a class="headerlink" href="#Step-4:-Generate-SSH-Key-Pair" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate SSH key pair locally</span>
ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-b<span class="w"> </span><span class="m">4096</span><span class="w"> </span>-f<span class="w"> </span>~/.ssh/aws-clustrix-key

<span class="c1"># Import public key to AWS</span>
aws<span class="w"> </span>ec2<span class="w"> </span>import-key-pair<span class="w"> </span>--key-name<span class="w"> </span><span class="s2">&quot;clustrix-key&quot;</span><span class="w"> </span>--public-key-material<span class="w"> </span>fileb://~/.ssh/aws-clustrix-key.pub
</pre></div>
</div>
</section>
</section>
<section id="Installation-and-Setup">
<h2>Installation and Setup<a class="headerlink" href="#Installation-and-Setup" title="Link to this heading">¶</a></h2>
<p>Install Clustrix with AWS dependencies:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install Clustrix with AWS support</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>clustrix<span class="w"> </span>boto3<span class="w"> </span>awscli

<span class="c1"># Import required libraries</span>
<span class="kn">import</span> <span class="nn">clustrix</span>
<span class="kn">from</span> <span class="nn">clustrix</span> <span class="kn">import</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">configure</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>
</div>
</div>
</section>
<section id="AWS-Credentials-Configuration">
<h2>AWS Credentials Configuration<a class="headerlink" href="#AWS-Credentials-Configuration" title="Link to this heading">¶</a></h2>
<p>Configure your AWS credentials using one of the following methods:</p>
<section id="Option-1:-AWS-CLI-Configuration-(Recommended)">
<h3>Option 1: AWS CLI Configuration (Recommended)<a class="headerlink" href="#Option-1:-AWS-CLI-Configuration-(Recommended)" title="Link to this heading">¶</a></h3>
<p>Run the following command in your terminal to configure credentials interactively:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>configure
</pre></div>
</div>
<p>You’ll be prompted to enter:</p>
<ul class="simple">
<li><p>AWS Access Key ID</p></li>
<li><p>AWS Secret Access Key</p></li>
<li><p>Default region name (e.g., us-east-1)</p></li>
<li><p>Default output format (json)</p></li>
</ul>
<p>This creates credential files at <code class="docutils literal notranslate"><span class="pre">~/.aws/credentials</span></code> and <code class="docutils literal notranslate"><span class="pre">~/.aws/config</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure AWS CLI (run this in terminal)</span>
<span class="c1"># aws configure</span>

<span class="c1"># Verify configuration</span>
<span class="o">!</span>aws<span class="w"> </span>sts<span class="w"> </span>get-caller-identity
</pre></div>
</div>
</div>
</section>
<section id="Option-2:-Environment-Variables">
<h3>Option 2: Environment Variables<a class="headerlink" href="#Option-2:-Environment-Variables" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option 2: Set AWS credentials as environment variables (if needed)</span>
<span class="c1"># os.environ[&#39;AWS_ACCESS_KEY_ID&#39;] = &#39;your-access-key&#39;</span>
<span class="c1"># os.environ[&#39;AWS_SECRET_ACCESS_KEY&#39;] = &#39;your-secret-key&#39;</span>
<span class="c1"># os.environ[&#39;AWS_DEFAULT_REGION&#39;] = &#39;us-east-1&#39;</span>

<span class="c1"># Test AWS connection</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ec2</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span>
    <span class="n">regions</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">describe_regions</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Successfully connected to AWS. Available regions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="s1">&#39;Regions&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ AWS connection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Method-1:-Direct-EC2-Instance-Configuration">
<h2>Method 1: Direct EC2 Instance Configuration<a class="headerlink" href="#Method-1:-Direct-EC2-Instance-Configuration" title="Link to this heading">¶</a></h2>
<section id="Prerequisites:-Create-Security-Group">
<h3>Prerequisites: Create Security Group<a class="headerlink" href="#Prerequisites:-Create-Security-Group" title="Link to this heading">¶</a></h3>
<p>Before launching an EC2 instance, you need to create a security group that allows SSH access. You can do this through the AWS Console or use the function provided in the Security section below.</p>
<p><strong>Quick Setup via AWS Console:</strong></p>
<ol class="arabic simple">
<li><p>Go to EC2 → Security Groups → Create Security Group</p></li>
<li><p>Name: <code class="docutils literal notranslate"><span class="pre">clustrix-sg</span></code></p></li>
<li><p>Add inbound rule: SSH (port 22) from your IP address only</p></li>
<li><p>Note the Security Group ID (sg-xxxxxxxxx)</p></li>
</ol>
</section>
<section id="Launch-EC2-Instance-for-Clustrix">
<h3>Launch EC2 Instance for Clustrix<a class="headerlink" href="#Launch-EC2-Instance-for-Clustrix" title="Link to this heading">¶</a></h3>
<p>This example shows how to programmatically launch an EC2 instance suitable for Clustrix:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">launch_clustrix_ec2_instance</span><span class="p">(</span><span class="n">key_name</span><span class="p">,</span> <span class="n">security_group_id</span><span class="p">,</span> <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;t3.large&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Launch an EC2 instance configured for Clustrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        key_name: Name of your EC2 key pair</span>
<span class="sd">        security_group_id: Security group ID that allows SSH access</span>
<span class="sd">        instance_type: EC2 instance type</span>

<span class="sd">    Returns:</span>
<span class="sd">        Instance ID and public IP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ec2</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span>

    <span class="c1"># User data script to setup Python environment</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#!/bin/bash</span>
<span class="s1">yum update -y</span>
<span class="s1">yum install -y python3 python3-pip git</span>
<span class="s1">pip3 install clustrix numpy scipy pandas</span>

<span class="s1"># Install uv for faster package management</span>
<span class="s1">curl -LsSf https://astral.sh/uv/install.sh | sh</span>
<span class="s1">source $HOME/.cargo/env</span>

<span class="s1"># Create clustrix user</span>
<span class="s1">useradd -m -s /bin/bash clustrix</span>
<span class="s1">mkdir -p /home/clustrix/.ssh</span>
<span class="s1">cp /home/ec2-user/.ssh/authorized_keys /home/clustrix/.ssh/</span>
<span class="s1">chown -R clustrix:clustrix /home/clustrix/.ssh</span>
<span class="s1">chmod 700 /home/clustrix/.ssh</span>
<span class="s1">chmod 600 /home/clustrix/.ssh/authorized_keys</span>

<span class="s1"># Setup sudo access</span>
<span class="s1">echo &quot;clustrix ALL=(ALL) NOPASSWD:ALL&quot; &gt;&gt; /etc/sudoers</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">run_instances</span><span class="p">(</span>
            <span class="n">ImageId</span><span class="o">=</span><span class="s1">&#39;ami-0c02fb55956c7d316&#39;</span><span class="p">,</span>  <span class="c1"># Amazon Linux 2 AMI</span>
            <span class="n">MinCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">MaxCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">InstanceType</span><span class="o">=</span><span class="n">instance_type</span><span class="p">,</span>
            <span class="n">KeyName</span><span class="o">=</span><span class="n">key_name</span><span class="p">,</span>
            <span class="n">SecurityGroupIds</span><span class="o">=</span><span class="p">[</span><span class="n">security_group_id</span><span class="p">],</span>
            <span class="n">UserData</span><span class="o">=</span><span class="n">user_data</span><span class="p">,</span>
            <span class="n">TagSpecifications</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">&#39;ResourceType&#39;</span><span class="p">:</span> <span class="s1">&#39;instance&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Tags&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s1">&#39;Key&#39;</span><span class="p">:</span> <span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="s1">&#39;Clustrix-Compute-Node&#39;</span><span class="p">},</span>
                        <span class="p">{</span><span class="s1">&#39;Key&#39;</span><span class="p">:</span> <span class="s1">&#39;Purpose&#39;</span><span class="p">,</span> <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="s1">&#39;Clustrix-Tutorial&#39;</span><span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">instance_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Instances&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;InstanceId&#39;</span><span class="p">]</span>

        <span class="c1"># Wait for instance to be running</span>
        <span class="n">waiter</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">get_waiter</span><span class="p">(</span><span class="s1">&#39;instance_running&#39;</span><span class="p">)</span>
        <span class="n">waiter</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">InstanceIds</span><span class="o">=</span><span class="p">[</span><span class="n">instance_id</span><span class="p">])</span>

        <span class="c1"># Get public IP</span>
        <span class="n">instance_info</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">describe_instances</span><span class="p">(</span><span class="n">InstanceIds</span><span class="o">=</span><span class="p">[</span><span class="n">instance_id</span><span class="p">])</span>
        <span class="n">public_ip</span> <span class="o">=</span> <span class="n">instance_info</span><span class="p">[</span><span class="s1">&#39;Reservations&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Instances&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PublicIpAddress&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">instance_id</span><span class="p">,</span> <span class="n">public_ip</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error launching instance: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># Example usage (uncomment and modify with your details)</span>
<span class="c1"># instance_id, public_ip = launch_clustrix_ec2_instance(</span>
<span class="c1">#     key_name=&#39;clustrix-key&#39;,</span>
<span class="c1">#     security_group_id=&#39;sg-xxxxxxxxx&#39;</span>
<span class="c1"># )</span>
<span class="c1">#</span>
<span class="c1"># if instance_id and public_ip:</span>
<span class="c1">#     print(f&quot;✓ Instance launched: {instance_id}&quot;)</span>
<span class="c1">#     print(f&quot;✓ Public IP: {public_ip}&quot;)</span>
<span class="c1">#     print(&quot;⏳ Wait 2-3 minutes for user data script to complete before connecting.&quot;)</span>
<span class="c1"># else:</span>
<span class="c1">#     print(&quot;✗ Failed to launch instance&quot;)</span>
</pre></div>
</div>
</div>
</section>
<section id="Configure-Clustrix-for-EC2">
<h3>Configure Clustrix for EC2<a class="headerlink" href="#Configure-Clustrix-for-EC2" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure Clustrix to use your EC2 instance</span>
<span class="n">configure</span><span class="p">(</span>
    <span class="n">cluster_type</span><span class="o">=</span><span class="s2">&quot;ssh&quot;</span><span class="p">,</span>
    <span class="n">cluster_host</span><span class="o">=</span><span class="s2">&quot;your-ec2-public-ip&quot;</span><span class="p">,</span>  <span class="c1"># Replace with actual IP</span>
    <span class="n">username</span><span class="o">=</span><span class="s2">&quot;clustrix&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;ec2-user&quot; if using default user</span>
    <span class="n">key_file</span><span class="o">=</span><span class="s2">&quot;~/.ssh/your-key.pem&quot;</span><span class="p">,</span>  <span class="c1"># Path to your private key</span>
    <span class="n">remote_work_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/clustrix&quot;</span><span class="p">,</span>
    <span class="n">package_manager</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>  <span class="c1"># Will use uv if available, fallback to pip</span>
    <span class="n">default_cores</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">default_memory</span><span class="o">=</span><span class="s2">&quot;8GB&quot;</span><span class="p">,</span>
    <span class="n">default_time</span><span class="o">=</span><span class="s2">&quot;01:00:00&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Configuration Complete!</strong></p>
<p>Your Clustrix is now configured to use the EC2 instance. Make sure to replace <code class="docutils literal notranslate"><span class="pre">your-ec2-public-ip</span></code> with the actual IP address of your running EC2 instance.</p>
</section>
<section id="Example:-Remote-Computation-on-EC2">
<h3>Example: Remote Computation on EC2<a class="headerlink" href="#Example:-Remote-Computation-on-EC2" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@cluster</span><span class="p">(</span><span class="n">cores</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;4GB&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">aws_monte_carlo_pi</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">1000000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate π using Monte Carlo method on AWS EC2.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="c1"># Generate random points</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>

    <span class="c1"># Count points inside unit circle</span>
    <span class="n">inside_circle</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="n">pi_estimate</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inside_circle</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_samples</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;pi_estimate&#39;</span><span class="p">:</span> <span class="n">pi_estimate</span><span class="p">,</span>
        <span class="s1">&#39;n_samples&#39;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pi_estimate</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="p">}</span>

<span class="c1"># Example usage (uncomment to run on your EC2 instance):</span>
<span class="c1"># result = aws_monte_carlo_pi(n_samples=5000000)</span>
<span class="c1"># print(f&quot;π estimate: {result[&#39;pi_estimate&#39;]:.6f}&quot;)</span>
<span class="c1"># print(f&quot;Error: {result[&#39;error&#39;]:.6f}&quot;)</span>
<span class="c1"># print(f&quot;Samples used: {result[&#39;n_samples&#39;]:,}&quot;)</span>
</pre></div>
</div>
</div>
<p><strong>Ready to Run!</strong></p>
<p>The Monte Carlo π estimation function is now defined and ready to execute on your EC2 instance. Simply uncomment the example usage lines above to run the computation remotely on AWS.</p>
</section>
</section>
<section id="Method-2:-AWS-Batch-Configuration">
<h2>Method 2: AWS Batch Configuration<a class="headerlink" href="#Method-2:-AWS-Batch-Configuration" title="Link to this heading">¶</a></h2>
<p>AWS Batch provides managed job scheduling for more complex workloads:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_aws_batch_environment</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example of setting up AWS Batch compute environment.</span>
<span class="sd">    This is a template - you&#39;ll need to adapt it to your specific needs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;batch&#39;</span><span class="p">)</span>
    <span class="n">ec2</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span>
    <span class="n">iam</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;iam&#39;</span><span class="p">)</span>

    <span class="c1"># This is a simplified example - real setup requires:</span>
    <span class="c1"># 1. VPC and subnet configuration</span>
    <span class="c1"># 2. IAM roles and policies</span>
    <span class="c1"># 3. Security groups</span>
    <span class="c1"># 4. Compute environment</span>
    <span class="c1"># 5. Job queue</span>
    <span class="c1"># 6. Job definition</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;compute_environment&#39;</span><span class="p">:</span> <span class="s1">&#39;clustrix-batch-env&#39;</span><span class="p">,</span>
        <span class="s1">&#39;job_queue&#39;</span><span class="p">:</span> <span class="s1">&#39;clustrix-queue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;job_definition&#39;</span><span class="p">:</span> <span class="s1">&#39;clustrix-job-def&#39;</span>
    <span class="p">}</span>

<span class="c1"># batch_config = create_aws_batch_environment()</span>
</pre></div>
</div>
</div>
<p><strong>Note on AWS Batch Complexity</strong></p>
<p>AWS Batch setup is complex and requires careful configuration of networking, IAM, and compute resources. For easier HPC setups, consider using AWS ParallelCluster or EKS instead. The function above provides a template structure for those who want to implement full Batch integration.</p>
</section>
<section id="Method-3:-AWS-ParallelCluster-Integration">
<h2>Method 3: AWS ParallelCluster Integration<a class="headerlink" href="#Method-3:-AWS-ParallelCluster-Integration" title="Link to this heading">¶</a></h2>
<p>AWS ParallelCluster is designed for HPC workloads and integrates well with Clustrix:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure Clustrix for ParallelCluster</span>
<span class="k">def</span> <span class="nf">configure_for_parallelcluster</span><span class="p">(</span><span class="n">cluster_name</span><span class="p">,</span> <span class="n">master_ip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure Clustrix to use AWS ParallelCluster.&quot;&quot;&quot;</span>
    <span class="n">configure</span><span class="p">(</span>
        <span class="n">cluster_type</span><span class="o">=</span><span class="s2">&quot;slurm&quot;</span><span class="p">,</span>
        <span class="n">cluster_host</span><span class="o">=</span><span class="n">master_ip</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="s2">&quot;ec2-user&quot;</span><span class="p">,</span>
        <span class="n">key_file</span><span class="o">=</span><span class="s2">&quot;~/.ssh/aws-clustrix-key&quot;</span><span class="p">,</span>
        <span class="n">remote_work_dir</span><span class="o">=</span><span class="s2">&quot;/shared/clustrix&quot;</span><span class="p">,</span>  <span class="c1"># Use shared storage</span>
        <span class="n">package_manager</span><span class="o">=</span><span class="s2">&quot;uv&quot;</span><span class="p">,</span>
        <span class="n">module_loads</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python3&quot;</span><span class="p">],</span>  <span class="c1"># Load required modules</span>
        <span class="n">default_cores</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">default_memory</span><span class="o">=</span><span class="s2">&quot;8GB&quot;</span><span class="p">,</span>
        <span class="n">default_time</span><span class="o">=</span><span class="s2">&quot;01:00:00&quot;</span><span class="p">,</span>
        <span class="n">default_partition</span><span class="o">=</span><span class="s2">&quot;compute&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Configured Clustrix for ParallelCluster: </span><span class="si">{</span><span class="n">cluster_name</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Example usage:</span>
<span class="c1"># result = configure_for_parallelcluster(&quot;my-cluster&quot;, &quot;10.0.0.100&quot;)</span>
<span class="c1"># print(result)</span>
</pre></div>
</div>
</div>
<section id="ParallelCluster-Configuration-Example">
<h3>ParallelCluster Configuration Example<a class="headerlink" href="#ParallelCluster-Configuration-Example" title="Link to this heading">¶</a></h3>
<p>Here’s a sample ParallelCluster configuration file for use with Clustrix:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save as ~/.parallelcluster/config</span>
<span class="k">[aws]</span>
<span class="na">aws_region_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">us-east-1</span>

<span class="k">[global]</span>
<span class="na">cluster_template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">clustrix-template</span>
<span class="na">update_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
<span class="na">sanity_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>

<span class="k">[cluster clustrix-template]</span>
<span class="na">key_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">your-key-name</span>
<span class="na">vpc_settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">vpc-settings</span>
<span class="na">compute_instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">c5.xlarge</span>
<span class="na">master_instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">t3.medium</span>
<span class="na">initial_queue_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
<span class="na">max_queue_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">10</span>
<span class="na">scheduler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">slurm</span>
<span class="na">placement_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">DYNAMIC</span>
<span class="na">placement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">compute</span>
<span class="na">disable_hyperthreading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
<span class="na">post_install</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://raw.githubusercontent.com/your-repo/clustrix-setup.sh</span>

<span class="k">[vpc vpc-settings]</span>
<span class="na">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">vpc-xxxxxxxxx</span>
<span class="na">master_subnet_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">subnet-xxxxxxxxx</span>
<span class="na">compute_subnet_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">subnet-xxxxxxxxx</span>
</pre></div>
</div>
</section>
</section>
<section id="Data-Management-with-S3">
<h2>Data Management with S3<a class="headerlink" href="#Data-Management-with-S3" title="Link to this heading">¶</a></h2>
<p>Integrate S3 for data input/output:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@cluster</span><span class="p">(</span><span class="n">cores</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;4GB&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">process_s3_data</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">input_key</span><span class="p">,</span> <span class="n">output_key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process data from S3 and save results back to S3.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">boto3</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
    <span class="kn">import</span> <span class="nn">io</span>

    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>

    <span class="c1"># Download data from S3</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">input_key</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="c1"># Process the data</span>
    <span class="n">processed_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;original_shape&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
        <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span><span class="p">,</span>
        <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;processing_timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1"># Upload results to S3</span>
    <span class="n">output_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">processed_data</span><span class="p">,</span> <span class="n">output_buffer</span><span class="p">)</span>
    <span class="n">output_buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
        <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span>
        <span class="n">Key</span><span class="o">=</span><span class="n">output_key</span><span class="p">,</span>
        <span class="n">Body</span><span class="o">=</span><span class="n">output_buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Processed data saved to s3://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">output_key</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Example S3 utility functions</span>
<span class="k">def</span> <span class="nf">upload_to_s3</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Upload data to S3.&quot;&quot;&quot;</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">Body</span><span class="o">=</span><span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Data uploaded to s3://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">download_from_s3</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download data from S3.&quot;&quot;&quot;</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Data downloaded from s3://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="c1"># Example usage:</span>
<span class="c1"># sample_data = np.random.rand(1000, 100)</span>
<span class="c1"># upload_to_s3(sample_data, &#39;your-bucket&#39;, &#39;input/sample_data.pkl&#39;)</span>
<span class="c1"># result = process_s3_data(&#39;your-bucket&#39;, &#39;input/sample_data.pkl&#39;, &#39;output/results.pkl&#39;)</span>
<span class="c1"># print(result)</span>
</pre></div>
</div>
</div>
</section>
<section id="Security-Best-Practices">
<h2>Security Best Practices<a class="headerlink" href="#Security-Best-Practices" title="Link to this heading">¶</a></h2>
<section id="Security-Group-Configuration">
<h3>Security Group Configuration<a class="headerlink" href="#Security-Group-Configuration" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_clustrix_security_group</span><span class="p">(</span><span class="n">vpc_id</span><span class="p">,</span> <span class="n">your_ip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a security group for Clustrix with minimal required access.</span>

<span class="sd">    Args:</span>
<span class="sd">        vpc_id: VPC ID where to create the security group</span>
<span class="sd">        your_ip: Your public IP address (get from https://checkip.amazonaws.com)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Security group ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ec2</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">create_security_group</span><span class="p">(</span>
            <span class="n">GroupName</span><span class="o">=</span><span class="s1">&#39;clustrix-sg&#39;</span><span class="p">,</span>
            <span class="n">Description</span><span class="o">=</span><span class="s1">&#39;Security group for Clustrix compute nodes&#39;</span><span class="p">,</span>
            <span class="n">VpcId</span><span class="o">=</span><span class="n">vpc_id</span>
        <span class="p">)</span>

        <span class="n">sg_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;GroupId&#39;</span><span class="p">]</span>

        <span class="c1"># Add SSH access from your IP only</span>
        <span class="n">ec2</span><span class="o">.</span><span class="n">authorize_security_group_ingress</span><span class="p">(</span>
            <span class="n">GroupId</span><span class="o">=</span><span class="n">sg_id</span><span class="p">,</span>
            <span class="n">IpPermissions</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">&#39;IpProtocol&#39;</span><span class="p">:</span> <span class="s1">&#39;tcp&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;FromPort&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
                    <span class="s1">&#39;ToPort&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
                    <span class="s1">&#39;IpRanges&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;CidrIp&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">your_ip</span><span class="si">}</span><span class="s1">/32&#39;</span><span class="p">,</span> <span class="s1">&#39;Description&#39;</span><span class="p">:</span> <span class="s1">&#39;SSH access&#39;</span><span class="p">}]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Created security group: </span><span class="si">{</span><span class="n">sg_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sg_id</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ Error creating security group: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Helper function to get your public IP</span>
<span class="k">def</span> <span class="nf">get_my_public_ip</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get your current public IP address.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">requests</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://checkip.amazonaws.com&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not determine public IP. Please check manually at https://checkip.amazonaws.com&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Example usage:</span>
<span class="c1"># my_ip = get_my_public_ip()</span>
<span class="c1"># if my_ip:</span>
<span class="c1">#     print(f&quot;Your public IP: {my_ip}&quot;)</span>
<span class="c1">#     # sg_id = create_clustrix_security_group(&#39;vpc-xxxxxxxxx&#39;, my_ip)</span>
</pre></div>
</div>
</div>
</section>
<section id="AWS-Security-Checklist-for-Clustrix">
<h3>AWS Security Checklist for Clustrix<a class="headerlink" href="#AWS-Security-Checklist-for-Clustrix" title="Link to this heading">¶</a></h3>
<p>✓ <strong>Authentication &amp; Access</strong></p>
<ul class="simple">
<li><p>Use IAM roles instead of access keys when possible</p></li>
<li><p>Restrict security groups to your IP address only</p></li>
<li><p>Regularly rotate SSH keys and access credentials</p></li>
</ul>
<p>✓ <strong>Network Security</strong></p>
<ul class="simple">
<li><p>Use private subnets for compute nodes when possible</p></li>
<li><p>Enable VPC Flow Logs for network monitoring</p></li>
<li><p>Use AWS Systems Manager Session Manager instead of direct SSH when possible</p></li>
</ul>
<p>✓ <strong>Data Protection</strong></p>
<ul class="simple">
<li><p>Use encrypted EBS volumes and S3 buckets</p></li>
<li><p>Enable CloudTrail for API logging</p></li>
</ul>
<p>✓ <strong>Monitoring &amp; Management</strong></p>
<ul class="simple">
<li><p>Set up billing alerts to monitor costs</p></li>
<li><p>Tag all resources for cost tracking and management</p></li>
</ul>
</section>
</section>
<section id="Cost-Optimization">
<h2>Cost Optimization<a class="headerlink" href="#Cost-Optimization" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import Clustrix cost monitoring for AWS</span>
<span class="kn">from</span> <span class="nn">clustrix</span> <span class="kn">import</span> <span class="n">cost_tracking_decorator</span><span class="p">,</span> <span class="n">get_cost_monitor</span><span class="p">,</span> <span class="n">generate_cost_report</span><span class="p">,</span> <span class="n">get_pricing_info</span>

<span class="c1"># Example 1: Cost tracking with AWS instances</span>
<span class="nd">@cost_tracking_decorator</span><span class="p">(</span><span class="s1">&#39;aws&#39;</span><span class="p">,</span> <span class="s1">&#39;p3.2xlarge&#39;</span><span class="p">)</span>
<span class="nd">@cluster</span><span class="p">(</span><span class="n">cores</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;60GB&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">aws_training_with_cost_tracking</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example training function with AWS cost tracking.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting AWS training with cost monitoring...&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Simulate training</span>

    <span class="c1"># Simulate GPU workload</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training completed!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="mf">0.92</span><span class="p">,</span> <span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}</span>

<span class="c1"># Example 2: Compare AWS pricing</span>
<span class="k">def</span> <span class="nf">compare_aws_pricing</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare AWS EC2 pricing for different instance types.&quot;&quot;&quot;</span>
    <span class="n">pricing</span> <span class="o">=</span> <span class="n">get_pricing_info</span><span class="p">(</span><span class="s1">&#39;aws&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pricing</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AWS EC2 On-Demand Pricing (USD/hour):&quot;</span><span class="p">)</span>

        <span class="c1"># Group by category</span>
        <span class="n">gpu_instances</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pricing</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;p3&#39;</span><span class="p">,</span> <span class="s1">&#39;p4d&#39;</span><span class="p">,</span> <span class="s1">&#39;g4dn&#39;</span><span class="p">))}</span>
        <span class="n">compute_instances</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pricing</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;c5&#39;</span><span class="p">)}</span>
        <span class="n">memory_instances</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pricing</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;r5&#39;</span><span class="p">)}</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">GPU Instances:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">instance</span><span class="p">,</span> <span class="n">price</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">gpu_instances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instance</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">/hour&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Compute Optimized:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">instance</span><span class="p">,</span> <span class="n">price</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">compute_instances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instance</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">/hour&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Memory Optimized:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">instance</span><span class="p">,</span> <span class="n">price</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">memory_instances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instance</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">/hour&quot;</span><span class="p">)</span>

<span class="c1"># Example 3: AWS Spot vs On-Demand cost analysis</span>
<span class="k">def</span> <span class="nf">aws_spot_cost_analysis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze potential savings with AWS Spot instances.&quot;&quot;&quot;</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="n">get_cost_monitor</span><span class="p">(</span><span class="s1">&#39;aws&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">monitor</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AWS Spot Instance Savings Analysis:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>

        <span class="n">instance_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p3.2xlarge&#39;</span><span class="p">,</span> <span class="s1">&#39;p3.8xlarge&#39;</span><span class="p">,</span> <span class="s1">&#39;g4dn.xlarge&#39;</span><span class="p">,</span> <span class="s1">&#39;c5.large&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instance_types</span><span class="p">:</span>
            <span class="n">on_demand</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">estimate_cost</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">use_spot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">spot</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">estimate_cost</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">use_spot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">savings</span> <span class="o">=</span> <span class="p">((</span><span class="n">on_demand</span><span class="o">.</span><span class="n">hourly_rate</span> <span class="o">-</span> <span class="n">spot</span><span class="o">.</span><span class="n">hourly_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">on_demand</span><span class="o">.</span><span class="n">hourly_rate</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  On-Demand: $</span><span class="si">{</span><span class="n">on_demand</span><span class="o">.</span><span class="n">hourly_rate</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">/hour&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Spot:      $</span><span class="si">{</span><span class="n">spot</span><span class="o">.</span><span class="n">hourly_rate</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">/hour&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Savings:   </span><span class="si">{</span><span class="n">savings</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

<span class="c1"># Example 4: AWS Batch cost estimation</span>
<span class="k">def</span> <span class="nf">estimate_aws_batch_costs</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate costs for AWS Batch workloads.&quot;&quot;&quot;</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="n">get_cost_monitor</span><span class="p">(</span><span class="s1">&#39;aws&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">monitor</span><span class="p">:</span>
        <span class="n">batch_estimate</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">estimate_batch_cost</span><span class="p">(</span>
            <span class="n">job_queue</span><span class="o">=</span><span class="s2">&quot;clustrix-batch-queue&quot;</span><span class="p">,</span>
            <span class="n">compute_environment</span><span class="o">=</span><span class="s2">&quot;clustrix-compute-env&quot;</span><span class="p">,</span>
            <span class="n">estimated_jobs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">avg_job_duration_hours</span><span class="o">=</span><span class="mf">0.25</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AWS Batch Cost Estimation:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Job Queue: </span><span class="si">{</span><span class="n">batch_estimate</span><span class="p">[</span><span class="s1">&#39;job_queue&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total Jobs: </span><span class="si">{</span><span class="n">batch_estimate</span><span class="p">[</span><span class="s1">&#39;estimated_jobs&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Avg Duration: </span><span class="si">{</span><span class="n">batch_estimate</span><span class="p">[</span><span class="s1">&#39;avg_job_duration_hours&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total Compute Hours: </span><span class="si">{</span><span class="n">batch_estimate</span><span class="p">[</span><span class="s1">&#39;total_compute_hours&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Estimated Cost: $</span><span class="si">{</span><span class="n">batch_estimate</span><span class="p">[</span><span class="s1">&#39;estimated_cost&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Cost per Job: $</span><span class="si">{</span><span class="n">batch_estimate</span><span class="p">[</span><span class="s1">&#39;cost_per_job&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Example 5: Regional pricing comparison</span>
<span class="k">def</span> <span class="nf">compare_aws_regions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare AWS pricing across different regions.&quot;&quot;&quot;</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="n">get_cost_monitor</span><span class="p">(</span><span class="s1">&#39;aws&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">monitor</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AWS Regional Pricing Comparison for p3.2xlarge:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">regional_pricing</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_region_pricing_comparison</span><span class="p">(</span><span class="s1">&#39;p3.2xlarge&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="n">pricing_info</span> <span class="ow">in</span> <span class="n">regional_pricing</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  On-Demand: $</span><span class="si">{</span><span class="n">pricing_info</span><span class="p">[</span><span class="s1">&#39;on_demand_hourly&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">/hour&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Est. Spot: $</span><span class="si">{</span><span class="n">pricing_info</span><span class="p">[</span><span class="s1">&#39;estimated_spot_hourly&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">/hour&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

<span class="c1"># Example 6: Real-time AWS cost monitoring</span>
<span class="k">def</span> <span class="nf">monitor_aws_costs</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Monitor current AWS resource usage and costs.&quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">generate_cost_report</span><span class="p">(</span><span class="s1">&#39;aws&#39;</span><span class="p">,</span> <span class="s1">&#39;p3.2xlarge&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current AWS Resource Status:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  CPU Usage: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;resource_usage&#39;</span><span class="p">][</span><span class="s1">&#39;cpu_percent&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Memory Usage: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;resource_usage&#39;</span><span class="p">][</span><span class="s1">&#39;memory_percent&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;resource_usage&#39;</span><span class="p">][</span><span class="s1">&#39;gpu_stats&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  GPU Count: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;resource_usage&#39;</span><span class="p">][</span><span class="s1">&#39;gpu_stats&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Hourly Rate: $</span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;cost_estimate&#39;</span><span class="p">][</span><span class="s1">&#39;hourly_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cost Optimization Recommendations:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  • </span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Run examples</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AWS Cost Monitoring Examples:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">1. AWS Pricing Comparison:&quot;</span><span class="p">)</span>
<span class="n">compare_aws_pricing</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. Spot Instance Savings Analysis:&quot;</span><span class="p">)</span>
<span class="n">aws_spot_cost_analysis</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3. AWS Batch Cost Estimation:&quot;</span><span class="p">)</span>
<span class="n">estimate_aws_batch_costs</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">4. Regional Pricing Comparison:&quot;</span><span class="p">)</span>
<span class="n">compare_aws_regions</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">5. Current AWS Status:&quot;</span><span class="p">)</span>
<span class="n">monitor_aws_costs</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ AWS cost monitoring examples ready!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;💡 Use @cost_tracking_decorator(&#39;aws&#39;, &#39;instance_type&#39;) for automatic cost tracking&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="AWS-Cost-Optimization-for-Clustrix">
<h3>AWS Cost Optimization for Clustrix<a class="headerlink" href="#AWS-Cost-Optimization-for-Clustrix" title="Link to this heading">¶</a></h3>
<section id="1.-Instance-Selection">
<h4>1. Instance Selection<a class="headerlink" href="#1.-Instance-Selection" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>Use Spot Instances</strong> for non-critical workloads (up to 90% savings)</p></li>
<li><p><strong>Choose right-sized instances</strong> (don’t over-provision)</p></li>
<li><p><strong>Consider AMD instances</strong> (often cheaper than Intel)</p></li>
</ul>
</section>
<section id="2.-Storage-Optimization">
<h4>2. Storage Optimization<a class="headerlink" href="#2.-Storage-Optimization" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Use <strong>S3 Intelligent Tiering</strong> for data</p></li>
<li><p>Delete temporary files and logs regularly</p></li>
<li><p>Use <strong>gp3 EBS volumes</strong> instead of gp2</p></li>
</ul>
</section>
<section id="3.-Network-Efficiency">
<h4>3. Network Efficiency<a class="headerlink" href="#3.-Network-Efficiency" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Use same AZ for compute and storage to avoid data transfer costs</p></li>
<li><p>Minimize cross-region data transfer</p></li>
</ul>
</section>
<section id="4.-Smart-Scheduling">
<h4>4. Smart Scheduling<a class="headerlink" href="#4.-Smart-Scheduling" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Use scheduled scaling for predictable workloads</p></li>
<li><p>Terminate instances when not in use</p></li>
<li><p>Use AWS Lambda for small, short-running tasks</p></li>
</ul>
</section>
<section id="5.-Monitoring-&amp;-Control">
<h4>5. Monitoring &amp; Control<a class="headerlink" href="#5.-Monitoring-&-Control" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Set up cost alerts and budgets</p></li>
<li><p>Use AWS Cost Explorer to analyze spending</p></li>
<li><p>Monitor with CloudWatch to optimize resource usage</p></li>
</ul>
</section>
</section>
</section>
<section id="Resource-Cleanup">
<h2>Resource Cleanup<a class="headerlink" href="#Resource-Cleanup" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cleanup_aws_resources</span><span class="p">(</span><span class="n">instance_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">security_group_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean up AWS resources to avoid ongoing charges.</span>

<span class="sd">    Args:</span>
<span class="sd">        instance_ids: List of EC2 instance IDs to terminate</span>
<span class="sd">        security_group_ids: List of security group IDs to delete</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ec2</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Terminate instances</span>
        <span class="k">if</span> <span class="n">instance_ids</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">terminate_instances</span><span class="p">(</span><span class="n">InstanceIds</span><span class="o">=</span><span class="n">instance_ids</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏳ Terminating instances: </span><span class="si">{</span><span class="n">instance_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Wait for termination</span>
            <span class="n">waiter</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">get_waiter</span><span class="p">(</span><span class="s1">&#39;instance_terminated&#39;</span><span class="p">)</span>
            <span class="n">waiter</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">InstanceIds</span><span class="o">=</span><span class="n">instance_ids</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Instances terminated.&quot;</span><span class="p">)</span>

        <span class="c1"># Delete security groups</span>
        <span class="k">if</span> <span class="n">security_group_ids</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sg_id</span> <span class="ow">in</span> <span class="n">security_group_ids</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ec2</span><span class="o">.</span><span class="n">delete_security_group</span><span class="p">(</span><span class="n">GroupId</span><span class="o">=</span><span class="n">sg_id</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Deleted security group: </span><span class="si">{</span><span class="n">sg_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ Could not delete security group </span><span class="si">{</span><span class="n">sg_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Cleanup completed!&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ Error during cleanup: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Helper function to list your running instances</span>
<span class="k">def</span> <span class="nf">list_running_instances</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all running EC2 instances in your account.&quot;&quot;&quot;</span>
    <span class="n">ec2</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">describe_instances</span><span class="p">(</span>
            <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;instance-state-name&#39;</span><span class="p">,</span> <span class="s1">&#39;Values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;running&#39;</span><span class="p">]}]</span>
        <span class="p">)</span>

        <span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">reservation</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Reservations&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">reservation</span><span class="p">[</span><span class="s1">&#39;Instances&#39;</span><span class="p">]:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Tags&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Name&#39;</span><span class="p">),</span> <span class="s1">&#39;No Name&#39;</span><span class="p">)</span>
                <span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;InstanceId&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="p">[</span><span class="s1">&#39;InstanceId&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s1">&#39;InstanceType&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="p">[</span><span class="s1">&#39;InstanceType&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;PublicIpAddress&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PublicIpAddress&#39;</span><span class="p">,</span> <span class="s1">&#39;No Public IP&#39;</span><span class="p">)</span>
                <span class="p">})</span>

        <span class="k">if</span> <span class="n">instances</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running instances:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">inst</span><span class="p">[</span><span class="s1">&#39;InstanceId&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">inst</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) - </span><span class="si">{</span><span class="n">inst</span><span class="p">[</span><span class="s1">&#39;InstanceType&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">inst</span><span class="p">[</span><span class="s1">&#39;PublicIpAddress&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No running instances found.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">instances</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ Error listing instances: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="c1"># Example cleanup (uncomment and modify as needed)</span>
<span class="c1"># instances = list_running_instances()</span>
<span class="c1"># cleanup_aws_resources(</span>
<span class="c1">#     instance_ids=[&#39;i-1234567890abcdef0&#39;],</span>
<span class="c1">#     security_group_ids=[&#39;sg-1234567890abcdef0&#39;]</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
<p><strong>⚠️ Important: Clean Up Resources</strong></p>
<p>Always remember to clean up AWS resources when you’re done to avoid ongoing charges! The cleanup function above helps automate this process.</p>
</section>
<section id="Advanced-Example:-Distributed-Machine-Learning">
<h2>Advanced Example: Distributed Machine Learning<a class="headerlink" href="#Advanced-Example:-Distributed-Machine-Learning" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@cluster</span><span class="p">(</span><span class="n">cores</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;8GB&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="s2">&quot;00:30:00&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">distributed_model_training</span><span class="p">(</span><span class="n">data_params</span><span class="p">,</span> <span class="n">model_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train a machine learning model on AWS with data from S3.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_params: Dictionary with S3 bucket and key information</span>
<span class="sd">        model_params: Dictionary with model hyperparameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with training results and model location</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">boto3</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
    <span class="kn">import</span> <span class="nn">io</span>
    <span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
    <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
    <span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

    <span class="c1"># Download training data from S3</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span>
        <span class="n">Bucket</span><span class="o">=</span><span class="n">data_params</span><span class="p">[</span><span class="s1">&#39;bucket&#39;</span><span class="p">],</span>
        <span class="n">Key</span><span class="o">=</span><span class="n">data_params</span><span class="p">[</span><span class="s1">&#39;training_data_key&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">)</span>

    <span class="c1"># Train model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">model_params</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Evaluate</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Save model to S3</span>
    <span class="n">model_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_buffer</span><span class="p">)</span>
    <span class="n">model_buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
        <span class="n">Bucket</span><span class="o">=</span><span class="n">data_params</span><span class="p">[</span><span class="s1">&#39;bucket&#39;</span><span class="p">],</span>
        <span class="n">Key</span><span class="o">=</span><span class="n">data_params</span><span class="p">[</span><span class="s1">&#39;model_output_key&#39;</span><span class="p">],</span>
        <span class="n">Body</span><span class="o">=</span><span class="n">model_buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span>
        <span class="s1">&#39;model_location&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="n">data_params</span><span class="p">[</span><span class="s1">&#39;bucket&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">data_params</span><span class="p">[</span><span class="s1">&#39;model_output_key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;training_samples&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span>
        <span class="s1">&#39;test_samples&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="p">}</span>

<span class="c1"># Example usage:</span>
<span class="c1"># data_config = {</span>
<span class="c1">#     &#39;bucket&#39;: &#39;your-ml-bucket&#39;,</span>
<span class="c1">#     &#39;training_data_key&#39;: &#39;datasets/training_data.pkl&#39;,</span>
<span class="c1">#     &#39;model_output_key&#39;: &#39;models/random_forest_model.pkl&#39;</span>
<span class="c1"># }</span>
<span class="c1">#</span>
<span class="c1"># model_config = {</span>
<span class="c1">#     &#39;n_estimators&#39;: 100,</span>
<span class="c1">#     &#39;max_depth&#39;: 10,</span>
<span class="c1">#     &#39;random_state&#39;: 42,</span>
<span class="c1">#     &#39;n_jobs&#39;: -1</span>
<span class="c1"># }</span>
<span class="c1">#</span>
<span class="c1"># result = distributed_model_training(data_config, model_config)</span>
<span class="c1"># print(f&quot;✓ Model trained with accuracy: {result[&#39;accuracy&#39;]:.4f}&quot;)</span>
<span class="c1"># print(f&quot;✓ Model saved to: {result[&#39;model_location&#39;]}&quot;)</span>
<span class="c1"># print(f&quot;✓ Training samples: {result[&#39;training_samples&#39;]:,}&quot;)</span>
<span class="c1"># print(f&quot;✓ Test samples: {result[&#39;test_samples&#39;]:,}&quot;)</span>
</pre></div>
</div>
</div>
</section>
<section id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Link to this heading">¶</a></h2>
<p>This tutorial covered:</p>
<ol class="arabic simple">
<li><p><strong>Setup</strong>: AWS credentials and Clustrix installation</p></li>
<li><p><strong>EC2 Integration</strong>: Direct instance configuration</p></li>
<li><p><strong>AWS Batch</strong>: Managed job scheduling</p></li>
<li><p><strong>ParallelCluster</strong>: HPC-optimized clusters</p></li>
<li><p><strong>S3 Integration</strong>: Data storage and retrieval</p></li>
<li><p><strong>Security</strong>: Best practices for safe deployment</p></li>
<li><p><strong>Cost Optimization</strong>: Strategies to minimize expenses</p></li>
<li><p><strong>Resource Management</strong>: Proper cleanup procedures</p></li>
</ol>
<section id="Next-Steps">
<h3>Next Steps<a class="headerlink" href="#Next-Steps" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Set up your AWS credentials and test the basic configuration</p></li>
<li><p>Start with a simple EC2 instance for initial testing</p></li>
<li><p>Consider ParallelCluster for production HPC workloads</p></li>
<li><p>Implement proper monitoring and cost controls</p></li>
<li><p>Explore AWS Spot instances for cost-effective batch processing</p></li>
</ul>
</section>
<section id="Resources">
<h3>Resources<a class="headerlink" href="#Resources" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.aws.amazon.com/parallelcluster/">AWS ParallelCluster Documentation</a></p></li>
<li><p><a class="reference external" href="https://docs.aws.amazon.com/batch/">AWS Batch User Guide</a></p></li>
<li><p><a class="reference external" href="https://hpc-workshops.com/">AWS HPC Workshops</a></p></li>
<li><p><a class="reference external" href="https://clustrix.readthedocs.io/">Clustrix Documentation</a></p></li>
</ul>
<p><strong>Remember</strong>: Always monitor your AWS costs and clean up resources when not in use!</p>
</section>
</section>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="basic_usage.html" title="Previous">
        <span aria-hidden="true">←&nbsp;</span>Clustrix Basic Usage Tutorial
    </a>
    <a class="float-right" href="azure_cloud_tutorial.html" title="Next">
        Microsoft Azure Cloud Tutorial <span aria-hidden="true">&nbsp;→</span>
    </a>
</nav>
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Amazon Web Services (AWS) Cloud Tutorial</a><ul>
<li><a class="reference internal" href="#Overview">Overview</a></li>
<li><a class="reference internal" href="#Prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#Complete-AWS-Setup-Guide">Complete AWS Setup Guide</a><ul>
<li><a class="reference internal" href="#Step-1:-Create-AWS-Account">Step 1: Create AWS Account</a></li>
<li><a class="reference internal" href="#Step-2:-Install-AWS-CLI">Step 2: Install AWS CLI</a></li>
<li><a class="reference internal" href="#Step-3:-Create-IAM-User-and-Access-Keys">Step 3: Create IAM User and Access Keys</a></li>
<li><a class="reference internal" href="#Step-4:-Generate-SSH-Key-Pair">Step 4: Generate SSH Key Pair</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Installation-and-Setup">Installation and Setup</a></li>
<li><a class="reference internal" href="#AWS-Credentials-Configuration">AWS Credentials Configuration</a><ul>
<li><a class="reference internal" href="#Option-1:-AWS-CLI-Configuration-(Recommended)">Option 1: AWS CLI Configuration (Recommended)</a></li>
<li><a class="reference internal" href="#Option-2:-Environment-Variables">Option 2: Environment Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Method-1:-Direct-EC2-Instance-Configuration">Method 1: Direct EC2 Instance Configuration</a><ul>
<li><a class="reference internal" href="#Prerequisites:-Create-Security-Group">Prerequisites: Create Security Group</a></li>
<li><a class="reference internal" href="#Launch-EC2-Instance-for-Clustrix">Launch EC2 Instance for Clustrix</a></li>
<li><a class="reference internal" href="#Configure-Clustrix-for-EC2">Configure Clustrix for EC2</a></li>
<li><a class="reference internal" href="#Example:-Remote-Computation-on-EC2">Example: Remote Computation on EC2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Method-2:-AWS-Batch-Configuration">Method 2: AWS Batch Configuration</a></li>
<li><a class="reference internal" href="#Method-3:-AWS-ParallelCluster-Integration">Method 3: AWS ParallelCluster Integration</a><ul>
<li><a class="reference internal" href="#ParallelCluster-Configuration-Example">ParallelCluster Configuration Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Data-Management-with-S3">Data Management with S3</a></li>
<li><a class="reference internal" href="#Security-Best-Practices">Security Best Practices</a><ul>
<li><a class="reference internal" href="#Security-Group-Configuration">Security Group Configuration</a></li>
<li><a class="reference internal" href="#AWS-Security-Checklist-for-Clustrix">AWS Security Checklist for Clustrix</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Cost-Optimization">Cost Optimization</a><ul>
<li><a class="reference internal" href="#AWS-Cost-Optimization-for-Clustrix">AWS Cost Optimization for Clustrix</a><ul>
<li><a class="reference internal" href="#1.-Instance-Selection">1. Instance Selection</a></li>
<li><a class="reference internal" href="#2.-Storage-Optimization">2. Storage Optimization</a></li>
<li><a class="reference internal" href="#3.-Network-Efficiency">3. Network Efficiency</a></li>
<li><a class="reference internal" href="#4.-Smart-Scheduling">4. Smart Scheduling</a></li>
<li><a class="reference internal" href="#5.-Monitoring-&amp;-Control">5. Monitoring &amp; Control</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#Resource-Cleanup">Resource Cleanup</a></li>
<li><a class="reference internal" href="#Advanced-Example:-Distributed-Machine-Learning">Advanced Example: Distributed Machine Learning</a></li>
<li><a class="reference internal" href="#Summary">Summary</a><ul>
<li><a class="reference internal" href="#Next-Steps">Next Steps</a></li>
<li><a class="reference internal" href="#Resources">Resources</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="PyPI">GitHub</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2025, Contextual Dynamics Laboratory
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>Last updated: Jun 28, 2025</small>
                <small>
                    Created using
                    <a class="text-white" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.5.0
                    </a>
                    and
                    <a class="text-white" href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 8.1.3
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="../_static/documentation_options.js?v=01f34227"></script>
        <script src="../_static/doctools.js?v=9bcbadda"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script type="text/javascript" src="../_static/dist/theme.js"></script>
        <script type="text/javascript" src="../_static/dist/vendor.js"></script>
        <script type="text/javascript" src="../_static/searchtools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("../searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>